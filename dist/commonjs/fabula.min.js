// Fabula version 0.10.0 generated by Haxe
!function(e,L){"use strict";e.fabula=e.fabula||{};function t(){return O.__string_rec(this,"")}var a,F={};function n(e,t){var n,r=Object.create(e);for(n in t)r[n]=t[n];return t.toString!==Object.prototype.toString&&(r.toString=t.toString),r}function q(e,t){this.r=new RegExp(e,t.split("u").join(""))}function w(){}function i(){}function b(){}function x(){this.b=""}q.__name__="EReg",q.prototype={replace:function(e,t){return e.replace(this.r,t)},__class__:q},w.__name__="HxOverrides",w.cca=function(e,t){e=e.charCodeAt(t);return e!=e?Z.get_undefined():e},w.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},w.remove=function(e,t){t=e.indexOf(t);return-1!=t&&(e.splice(t,1),!0)},w.now=function(){return Date.now()},Math.__name__="Math",i.__name__="Reflect",i.field=function(e,t){try{return e[t]}catch(e){return null}},i.callMethod=function(e,t,n){return t.apply(e,n)},i.isFunction=function(e){return"function"==typeof e&&!(O.isClass(e)||O.isEnum(e))},b.__name__="Std",b.string=function(e){return O.__string_rec(e,"")},b.parseInt=function(e){if(null!=e)for(var t=0,n=e.length;t<n;){var r=t++,i=T.fastCodeAt(e,r);if(i<=8||14<=i&&32!=i&&45!=i)return i=T.fastCodeAt(e,1+r),r=parseInt(e,120==i||88==i?16:10),isNaN(r)?null:r}return null},b.parseFloat=function(e){return parseFloat(e)};function f(){}function E(e){this.nodeType=e,this.children=[],this.attributeMap=N.toStringMap(null)}function p(e,t,n,r,i,a){null==a&&(a=!1),this.id=e,this.text=""!=t&&null!=t?t:e,this.type=n,this.target=i,this.condition=r,this.isExit=a,_.helperList.set(this.id,m.EVENT)}function U(e,t,n,r,i,a,s,o,u,l){null==a&&(a=!1),null==i&&(i=1),null==r&&(r=!1),this.id=e,this.text=t,this.conditions=n,this.isExit=r,this.once=a,this.count=0,this.speaker=s,this.listeners=o,this.environment=u,this.target=l,_.helperList.set(this.id,m.EVENT)}function s(e,t){this.condition=e,this.type=t}function l(){this.condition=[],s.call(this,this.condition,null)}function o(e,t,n){this._affirmation=n=null==n?!0:n,this._achievedListID=t,s.call(this,e,m.EVENT)}function r(){this.h=Object.create(null)}function u(e,t,n){this.id=e,this.type=t,this.set(n),this.startingValue=this.value,_.helperList.set(this.id,m.VARIABLE)}function C(e,t,n){this.xml=t,this.message=e,this.position=n,this.lineNumber=1;for(var r=this.positionAtLine=0,i=n;r<i;){var a=r++,a=T.fastCodeAt(t,a);10==a?(this.lineNumber++,this.positionAtLine=0):13!=a&&this.positionAtLine++}}x.__name__="StringBuf",x.prototype={add:function(e){this.b+=b.string(e)},addChar:function(e){this.b+=String.fromCodePoint(e)},addSub:function(e,t,n){this.b+=w.substr(e,t,null==n?null:n)},toString:function(){return this.b},__class__:x};var T=function(){},c=(T.__name__="StringTools",T.htmlEscape=function(e,t){for(var n=new x,r=new Y(e);r.hasNext();){var i=r.next();switch(i){case 34:t?n.add("&quot;"):n.addChar(i);break;case 38:n.add("&amp;");break;case 39:t?n.add("&#039;"):n.addChar(i);break;case 60:n.add("&lt;");break;case 62:n.add("&gt;");break;default:n.addChar(i)}}return n.toString()},T.isSpace=function(e,t){e=w.cca(e,t);return 8<e&&e<14||32==e},T.ltrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,n);)++n;return 0<n?w.substr(e,n,t-n):e},T.rtrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,t-n-1);)++n;return 0<n?w.substr(e,0,t-n):e},T.trim=function(e){return T.ltrim(T.rtrim(e))},T.fastCodeAt=function(e,t){return e.charCodeAt(t)},T.unsafeCodeAt=function(e,t){return e.charCodeAt(t)},T.utf16CodePointAt=function(e,t){var n=T.fastCodeAt(e,t);return n=55296<=n&&n<=56319?n-55232<<10|1023&T.fastCodeAt(e,t+1):n},f.__name__="Type",f.getClass=function(e){return O.getClass(e)},f.getClassName=function(e){return e.__name__},f.createEnum=function(e,t,n){var r=i.field(e,t);if(null==r)throw S.thrown("No such constructor "+t);if(i.isFunction(r)){if(null==n)throw S.thrown("Constructor "+t+" need parameters");return i.callMethod(e,r,n)}if(null!=n&&0!=n.length)throw S.thrown("Constructor "+t+" does not need parameters");return r},{}),h=(c.toString=function(e){switch(e){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}},E.__name__="Xml",E.parse=function(e){return V.parse(e)},E.createElement=function(e){var t=new E(E.Element);return t.set_nodeName(e),t},E.createPCData=function(e){var t=new E(E.PCData);return t.set_nodeValue(e),t},E.createCData=function(e){var t=new E(E.CData);return t.set_nodeValue(e),t},E.createComment=function(e){var t=new E(E.Comment);return t.set_nodeValue(e),t},E.createDocType=function(e){var t=new E(E.DocType);return t.set_nodeValue(e),t},E.createProcessingInstruction=function(e){var t=new E(E.ProcessingInstruction);return t.set_nodeValue(e),t},E.createDocument=function(){return new E(E.Document)},E.prototype={get_nodeName:function(){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));return this.nodeName},set_nodeName:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));return this.nodeName=e},get_nodeValue:function(){if(this.nodeType==E.Document||this.nodeType==E.Element)throw S.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":c.toString(this.nodeType)));return this.nodeValue},set_nodeValue:function(e){if(this.nodeType==E.Document||this.nodeType==E.Element)throw S.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":c.toString(this.nodeType)));return this.nodeValue=e},get:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));return N.get(this.attributeMap,e)},set:function(e,t){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));N.set(this.attributeMap,e,t)},exists:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));return N.exists(this.attributeMap,e)},attributes:function(){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":c.toString(this.nodeType)));return N.keys(this.attributeMap)},iterator:function(){return this.ensureElementType(),new I(this.children)},elements:function(){this.ensureElementType();for(var e=[],t=0,n=this.children;t<n.length;){var r=n[t];++t,r.nodeType==E.Element&&e.push(r)}return new I(e)},elementsNamed:function(e){this.ensureElementType();for(var t=[],n=0,r=this.children;n<r.length;){var i=r[n];++n,i.nodeType==E.Element&&i.get_nodeName()==e&&t.push(i)}return new I(t)},firstElement:function(){this.ensureElementType();for(var e=0,t=this.children;e<t.length;){var n=t[e];if(++e,n.nodeType==E.Element)return n}return null},addChild:function(e){this.ensureElementType(),null!=e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this},removeChild:function(e){return this.ensureElementType(),!!w.remove(this.children,e)&&!(e.parent=null)},toString:function(){return R.print(this)},ensureElementType:function(){if(this.nodeType!=E.Document&&this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":c.toString(this.nodeType)))},__class__:E},p.__name__="fabula.Choice",p.prototype={__class__:p},U.__name__="fabula.Event",U.prototype={getChoices:function(){if(this._cacheChoices=[],null!=this.choices)for(var e=0,t=this.choices.length;e<t;){var n=e++;null!=this.choices[n].condition&&!this.choices[n].condition.test()||this._cacheChoices.push(this.choices[n])}return 0==this._cacheChoices.length&&(this.isExit?this._cacheChoices.push(new p("EXIT","Quitter","quit",null,this.target,!0)):this._cacheChoices.push(new p("CONTINUE","Continuer","continue",null,this.target))),this._cacheChoices},selectChoice:function(e,t,n){var r=(n=null==n?!1:n)?this.choices:this._cacheChoices;if(null!=r)if(null!=e)for(var i=0,a=r.length;i<a;){var s=i++;if(r[s].id==e)return r[s]}else if(null!=t)return r[t];return null},testConditions:function(){return null==this.conditions||this.conditions.test()},addChoice:function(e){null==this.choices&&(this.choices=[],this._cacheChoices=[]),this.choices.push(e)},__class__:U},F["fabula.EEventType"]={__ename__:!0,__constructs__:null,QUEST:{_hx_name:"QUEST",_hx_index:0,__enum__:"fabula.EEventType",toString:t},RANDOM_ENCOUNTER:{_hx_name:"RANDOM_ENCOUNTER",_hx_index:1,__enum__:"fabula.EEventType",toString:t},SCENE:{_hx_name:"SCENE",_hx_index:2,__enum__:"fabula.EEventType",toString:t}}),h=(h.__constructs__=[h.QUEST,h.RANDOM_ENCOUNTER,h.SCENE],F["fabula.EPlayingType"]={__ename__:!0,__constructs__:null,SEQUENCE:{_hx_name:"SEQUENCE",_hx_index:0,__enum__:"fabula.EPlayingType",toString:t},DRAW:{_hx_name:"DRAW",_hx_index:1,__enum__:"fabula.EPlayingType",toString:t}}),h=(h.__constructs__=[h.SEQUENCE,h.DRAW],e.fabula.Fabula=function(e,t){this._questsID=[],this._encountersID=[],this._textsID=[],this.achievedListID=[],this._achievedCallback=t,this.conditionFactory=new _(this),this._sequences=[];for(var n=0;n<e.length;){var r=e[n];++n,this.init(r)}}),g=(h.__name__="fabula.Fabula",h.prototype={init:function(e){e=g.parse(e,this.conditionFactory,this.achievedListID);this.arrayMerge(this._sequences,e.sequences)},arrayMerge:function(e,t){for(var n=0,r=t.length;n<r;){var i=n++;e.push(t[i])}},mapMerge:function(e,t){for(var n,r=((n=N)instanceof Array?function(){return w.keyValueIter(n)}:"function"==typeof n.keyValueIterator?ee(n,n.keyValueIterator):n.keyValueIterator)(t);r.hasNext();){var i=r.next(),a=i.key,i=i.value;N.arrayWrite(e,a,i)}},reset:function(){this.achievedListID.splice(0,this.achievedListID.length);for(var e=0,t=this._sequences;e<t.length;){var n=t[e];if(++e,null!=n.variables)for(var r=0,i=n.variables.length;r<i;){var a=r++;y.getUserByIndex(n.variables,a).reset()}}},selectSequence:function(e,t){null==t&&(t=!0);for(var n=0,r=this._sequences.length;n<r;){var i=n++;if(this._sequences[i].id==e){i=this._sequences[i];if(t){if(null!=i.conditions&&!i.conditions.test())return null;this.currentSequence=i,this.currentSequence.start()}return i}}return null},getNextEvent:function(){var e=this.currentSequence.getNextEvent();return null!=e&&(this.achievedListID.push(e.id),null!=this._achievedCallback)&&this._achievedCallback(e.id),e},getCurrentEvent:function(){return this.currentSequence.getEvent()},selectChoice:function(e,t){var n=null;return null!=this.currentSequence&&this.currentSequence.current<this.currentSequence.events.length&&(n=this.currentSequence.getEvent().selectChoice(e,t),this.currentSequence.nextTarget=n.isExit?"$$EXIT$$":n.target),null!=n&&(this.achievedListID.push(e),null!=this._achievedCallback)&&this._achievedCallback(e),n},getVar:function(e){if(null!=this.currentSequence){e=y.get(this.currentSequence.variables,e);if(null!=e)return e}return null},updateVar:function(){},countWords:function(){for(var e=0,t=0,n=this._sequences;t<n.length;){var r=n[t];if(++t,null!=r.events)for(var i=0,a=r.events;i<a.length;){var s=a[i];if(++i,e+=s.text.split(" ").length,null!=s.choices)for(var o=0,u=s.choices;o<u.length;){var l=u[o];++o,e+=l.text.split(" ").length}}}return e},__class__:h},function(){}),B=(g.__name__="fabula.FabulaXmlParser",g.parse=function(e,t,n){g._conditionFactory=t,g._xml=D._new(E.parse(e).firstElement());for(var r=[],i=0,a=z.resolve(D.get_nodes(g._xml),"sequence");i<a.length;){var s=a[i];if(++i,k.resolve(D.get_has(s),"id")){var o=A.resolve(D.get_att(s),"id"),u=(g.ID_GEN_HELPER=o,g.ID_GEN_COUNT=0,[]),l=[],o=new B(o),s=(o.addConditions(g._conditionFactory.create(P.getString(s,"if"))),g.parseEvents(s,o,u,l));if(null!=s)if(console.log("fabula/FabulaXmlParser.hx:49:",s.id),null!=s.choices)for(var c=0,h=s.choices;c<h.length;){var _=h[c];++c,null==_.target&&(_.isExit=!0)}else s.isExit=!0;o.addSequence(u,l),r.push(o)}else console.log("fabula/FabulaXmlParser.hx:32:","id attribute is mandatory in the sequence tag")}for(i=0,a=z.resolve(D.get_nodes(g._xml),"list");i<a.length;){a[i];++i,console.log("fabula/FabulaXmlParser.hx:71:","coucou list")}return{sequences:r}},g.parseEvents=function(e,t,n,r,i){var a=null,s=D.get_elements(e);e:for(;s.hasNext();){var o=s.next();switch(D.get_name(o)){case"choice":if(null==a){console.log("fabula/FabulaXmlParser.hx:133:","impossible to add a choice without a parent event");break e}a.addChoice(new p(P.getString(o,"id",g.ID_GEN_HELPER+"_C"+ ++g.ID_GEN_COUNT),g.getText(o),P.getString(o,"type"),g._conditionFactory.create(P.getString(o,"if")),P.getString(o,"target"),P.getBool(o,"exit",a.isExit)));break;case"event":var u,l=P.getString(o,"id",g.ID_GEN_HELPER+"_E"+ ++g.ID_GEN_COUNT);if(null==i?u=P.getString(o,"if"):(u=i.id,i.target=l),a=new U(l,g.getText(o),g._conditionFactory.create(u),P.getBool(o,"exit",!1),P.getInt(o,"weight",1),P.getBool(o,"once",!1),P.getString(o,"speaker"),P.getString(o,"listeners"),P.getString(o,"environment"),P.getString(o,"target")),J.resolve(D.get_hasNode(o),"choice"))for(var c=0,h=z.resolve(D.get_nodes(o),"choice");c<h.length;){var _=h[c],d=(++c,new p(P.getString(_,"id",g.ID_GEN_HELPER+"_C"+ ++g.ID_GEN_COUNT),g.getText(_),P.getString(_,"type"),g._conditionFactory.create(P.getString(_,"if")),P.getString(_,"target"),P.getBool(_,"exit",a.isExit)));a.addChoice(d),J.resolve(D.get_hasNode(_),"event")&&g.parseEvents(_,t,n,r,d)}(null==i?n:r).push(a);break;case"variable":t.addVariable(A.resolve(D.get_att(o),"id"),f.createEnum(v,A.resolve(D.get_att(o),"type").toUpperCase()),A.resolve(D.get_att(o),"value"))}}return a},g.getText=function(e){var t=P.getString(e,"text");return t=""==t&&J.resolve(D.get_hasNode(e),"text")?D.get_innerData(K.resolve(D.get_node(e),"text")):t},function(e){this.id=e,this.current=-1,this.currentId=null,this.numCompleted=0,this.nextTarget=null}),_=(B.__name__="fabula.Sequence",B.prototype={addConditions:function(e){this.conditions=e},addVariable:function(e,t,n){switch(null==this.variables&&(this.variables=y._new()),t._hx_index){case 0:this.variables.push(new $(e,n));break;case 1:this.variables.push(new H(e,n));break;case 2:this.variables.push(new G(e,n))}},addSequence:function(e,t){null==this.events&&null==this.branches||console.log("fabula/Sequence.hx:62:","WARNING a new sequence will replace an old sequence"),this.events=e,this.branches=t},start:function(){if(this.current=-1,this.nextTarget=null,(this.currentId=null)!=this.variables)for(var e=0,t=this.variables.length;e<t;){var n=e++;y.getUserByIndex(this.variables,n).reset()}},getNextEvent:function(e){if(!(e=null==e?!1:e)&&-1<this.current&&this.current<this.events.length&&(this.events[this.current].isExit||"$$EXIT$$"==this.nextTarget))this.numCompleted++,console.log("fabula/Sequence.hx:94:","[Fabula] sequence completed");else if(this.current+1<=this.events.length){if(0<=this.current){if(null!=this.nextTarget&&""!=this.nextTarget)return e=this.nextTarget,this.nextTarget=null,this.getEvent(e);if(null!=this.events[this.current].target&&""!=this.events[this.current].target)return this.getEvent(this.events[this.current].target)}if(this.current++,this.current<this.events.length)return(e=this.events[this.current]).testConditions()?(this.currentId=e.id,e):this.getNextEvent(!0);this.numCompleted++,console.log("fabula/Sequence.hx:128:","sequence completed")}return null},getEvent:function(e){null==e&&(e=this.currentId);for(var t=0,n=this.events.length;t<n;){var r=t++;if(this.events[r].id==e)return this.current=r,this.currentId=e,this.events[r]}for(t=0,n=this.branches.length;t<n;){r=t++;if(this.branches[r].id==e)return this.currentId=e,this.branches[r]}return null},__class__:B},s.__name__="fabula.condition.Condition",s.prototype={test:function(){throw S.thrown("[Condition] Override test function")},__class__:s},l.__name__="fabula.condition.ConditionCollection",l.__super__=s,l.prototype=n(s.prototype,{add:function(e){this.condition.push(e)},test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,!n.test())return!1}return!0},hasType:function(e){for(var t=0,n=this.condition;t<n.length;){var r=n[t];if(++t,r.type==e)return!0}return!1},hasOnlyTypes:function(e){for(var t=0,n=this.condition;t<n.length;){var r=n[t];if(++t,null==r.type){if(!r.hasOnlyTypes(e))return!1}else if(-1==e.indexOf(r.type))return!1}return!0},__class__:l}),o.__name__="fabula.condition.ConditionEvent",o.__super__=s,o.prototype=n(s.prototype,{test:function(){for(var e=0,t=this._achievedListID;e<t.length;){var n=t[e];if(++e,n==this.condition)return this._affirmation}return!this._affirmation},__class__:o}),r.__name__="haxe.ds.StringMap",r.prototype={exists:function(e){return Object.prototype.hasOwnProperty.call(this.h,e)},get:function(e){return this.h[e]},set:function(e,t){this.h[e]=t},keys:function(){return new Q(this.h)},keyValueIterator:function(){return new W(this.h)},__class__:r},function(e){this.fabula=e}),M=(_.__name__="fabula.condition.ConditionFactory",_.prototype={create:function(e){if(""==e)return null;for(var t=new l,n=-1!=e.indexOf(",")?e.split(","):e.split("&"),r=0;r<n.length;){var i=n[r];if(++r,-1!=i.indexOf("|")){for(var a=new M,s=i.split("|"),o=0;o<s.length;){var u=s[o];++o,this.addToCollection(a,u)}t.add(a)}else this.addToCollection(t,i)}return t},addToCollection:function(e,t){var n=0==t.indexOf("!"),r=(t=n?w.substr(t,1,null):t).split("="),i=t;if(1<r.length&&(t=r[0],i=r[1]),_.helperList.exists(t)){r=_.helperList.get(t);if(null==r)throw S.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type");switch(r._hx_index){case 0:e.add(new o(t,this.fabula.achievedListID,!n));break;case 1:e.add(new j(t,i,ee(a=this.fabula,a.getVar),!n));break;default:throw S.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type")}}else e.add(new o(t,this.fabula.achievedListID,!n))},__class__:_},function(){l.call(this)}),j=(M.__name__="fabula.condition.ConditionOr",M.__super__=l,M.prototype=n(l.prototype,{test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,n.test())return!0}return!1},__class__:M}),function(e,t,n,r){this._affirmation=r=null==r?!0:r,this._getVar=n,this._operation=d.fromString(t.charAt(0)),null!=this._operation?this._targetValue=w.substr(t,1,null):(this._affirmation?this._operation="=":this._operation="!",this._targetValue=t),s.call(this,e,m.VARIABLE)}),d=(j.__name__="fabula.condition.ConditionVariable",j.__super__=s,j.prototype=n(s.prototype,{test:function(){var e=this._getVar(this.condition),t=e.convert(this._targetValue);switch(this._operation){case"!":return e.value!=t;case"=":return e.value==t;default:return!1}},__class__:j}),{}),m=(d.fromString=function(e){switch(e){case"!":return"!";case"!in":return"!in";case"<":return"<";case"<=":return"<=";case"=":return"=";case">":return">";case">=":return">=";case"in":return"in";default:return null}},F["fabula.condition.EConditionType"]={__ename__:!0,__constructs__:null,EVENT:{_hx_name:"EVENT",_hx_index:0,__enum__:"fabula.condition.EConditionType",toString:t},VARIABLE:{_hx_name:"VARIABLE",_hx_index:1,__enum__:"fabula.condition.EConditionType",toString:t},INVENTORY:{_hx_name:"INVENTORY",_hx_index:2,__enum__:"fabula.condition.EConditionType",toString:t},HAS_CHARACTER:{_hx_name:"HAS_CHARACTER",_hx_index:3,__enum__:"fabula.condition.EConditionType",toString:t},IS_CHARACTER:{_hx_name:"IS_CHARACTER",_hx_index:4,__enum__:"fabula.condition.EConditionType",toString:t},TRAIT:{_hx_name:"TRAIT",_hx_index:5,__enum__:"fabula.condition.EConditionType",toString:t},ATTRIBUTS:{_hx_name:"ATTRIBUTS",_hx_index:6,__enum__:"fabula.condition.EConditionType",toString:t},SKILLS:{_hx_name:"SKILLS",_hx_index:7,__enum__:"fabula.condition.EConditionType",toString:t},CUSTOM:((a=function(e){return{_hx_index:8,type:e,__enum__:"fabula.condition.EConditionType",toString:t}})._hx_name="CUSTOM",a.__params__=["type"],a)}),v=(m.__constructs__=[m.EVENT,m.VARIABLE,m.INVENTORY,m.HAS_CHARACTER,m.IS_CHARACTER,m.TRAIT,m.ATTRIBUTS,m.SKILLS,m.CUSTOM],F["fabula.condition.EVariableType"]={__ename__:!0,__constructs__:null,STRING:{_hx_name:"STRING",_hx_index:0,__enum__:"fabula.condition.EVariableType",toString:t},INT:{_hx_name:"INT",_hx_index:1,__enum__:"fabula.condition.EVariableType",toString:t},FLOAT:{_hx_name:"FLOAT",_hx_index:2,__enum__:"fabula.condition.EVariableType",toString:t}}),y=(v.__constructs__=[v.STRING,v.INT,v.FLOAT],u.__name__="fabula.condition.Variable",u.prototype={set:function(e){throw S.thrown("[Fabula > variable] This method needs to be overriden")},convert:function(e){throw S.thrown("[Fabula > variable] This method needs to be overriden")},reset:function(){this.value=this.startingValue},toString:function(){return"[var "+this.id+" : v:"+b.string(this.value)+", d:"+b.string(this.startingValue)+"]"},__class__:u},{}),G=(y._new=function(){return[]},y.getUserByIndex=function(e,t){return e[t]},y.get=function(e,t){for(var n=0;n<e.length;){var r=e[n];if(++n,r.id==t)return r}return null},function(e,t){u.call(this,e,v.FLOAT,t)}),H=(G.__name__="fabula.condition.VariableFloat",G.__super__=u,G.prototype=n(u.prototype,{set:function(e){var t=this.value;return this.value=b.parseFloat(e),t!=this.value},convert:function(e){return b.parseFloat(e)},__class__:G}),function(e,t){u.call(this,e,v.INT,t)}),$=(H.__name__="fabula.condition.VariableInt",H.__super__=u,H.prototype=n(u.prototype,{set:function(e){var t=this.value;return this.value=b.parseInt(e),t!=this.value},convert:function(e){return b.parseInt(e)},__class__:H}),function(e,t){u.call(this,e,v.STRING,t)}),S=($.__name__="fabula.condition.VariableString",$.__super__=u,$.prototype=n(u.prototype,{set:function(e){var t=this.value;return this.value=e,t!=this.value},convert:function(e){return e},__class__:$}),function(e,t,n){Error.call(this,e),this.message=e,this.__previousException=t,this.__nativeException=null!=n?n:this}),X=(S.__name__="haxe.Exception",S.thrown=function(e){return e instanceof S?e.get_native():e instanceof Error?e:new X(e)},S.__super__=Error,S.prototype=n(Error.prototype,{__shiftStack:function(){this.__skipStack++},get_native:function(){return this.__nativeException},__class__:S}),function(e,t,n){S.call(this,String(e),t,n),this.value=e,this.__shiftStack()}),N=(X.__name__="haxe.ValueException",X.__super__=S,X.prototype=n(S.prototype,{__class__:X}),{}),Q=(N.set=function(e,t,n){e.set(t,n)},N.get=function(e,t){return e.get(t)},N.exists=function(e,t){return e.exists(t)},N.keys=function(e){return e.keys()},N.keyValueIterator=function(e){return e.keyValueIterator()},N.arrayWrite=function(e,t,n){return e.set(t,n),n},N.toStringMap=function(e){return new r},function(e){this.h=e,this.keys=Object.keys(e),this.length=this.keys.length,this.current=0}),W=(Q.__name__="haxe.ds._StringMap.StringMapKeyIterator",Q.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.keys[this.current++]},__class__:Q},function(e){this.h=e,this.keys=Object.keys(e),this.length=this.keys.length,this.current=0}),I=(W.__name__="haxe.ds._StringMap.StringMapKeyValueIterator",W.prototype={hasNext:function(){return this.current<this.length},next:function(){var e=this.keys[this.current++];return{key:e,value:this.h[e]}},__class__:W},function(e){this.current=0,this.array=e}),Y=(I.__name__="haxe.iterators.ArrayIterator",I.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:I},function(e){this.offset=0,this.s=e}),K=(Y.__name__="haxe.iterators.StringIteratorUnicode",Y.prototype={hasNext:function(){return this.offset<this.s.length},next:function(){var e=T.utf16CodePointAt(this.s,this.offset++);return 65536<=e&&this.offset++,e},__class__:Y},{}),A=(K.resolve=function(e,t){var n=e.elementsNamed(t).next();if(null==n)throw e=e.nodeType==E.Document?"Document":e.get_nodeName(),S.thrown(e+" is missing element "+t);return D._new(n)},{}),k=(A.resolve=function(e,t){if(e.nodeType==E.Document)throw S.thrown("Cannot access document attribute "+t);var n=e.get(t);if(null==n)throw S.thrown(e.get_nodeName()+" is missing attribute "+t);return n},{}),J=(k.resolve=function(e,t){if(e.nodeType==E.Document)throw S.thrown("Cannot access document attribute "+t);return e.exists(t)},{}),z=(J.resolve=function(e,t){return e.elementsNamed(t).hasNext()},{}),D=(z.resolve=function(e,t){for(var n=[],r=e.elementsNamed(t);r.hasNext();){var i=r.next();n.push(D._new(i))}return n},{}),V=(D.get_x=function(e){return e},D.get_name=function(e){return e.nodeType==E.Document?"Document":e.get_nodeName()},D.get_node=function(e){return D.get_x(e)},D.get_nodes=function(e){return e},D.get_att=function(e){return e},D.get_has=function(e){return e},D.get_hasNode=function(e){return D.get_x(e)},D.get_elements=function(e){return e.elements()},D._new=function(e){if(e.nodeType!=E.Document&&e.nodeType!=E.Element)throw S.thrown("Invalid nodeType "+(null==e.nodeType?"null":c.toString(e.nodeType)));return e},D.get_innerData=function(e){var t=e.iterator();if(!t.hasNext())throw S.thrown(D.get_name(e)+" does not have data");var n=t.next();if(t.hasNext()){var r=t.next();if(n.nodeType==E.PCData&&r.nodeType==E.CData&&""==T.trim(n.get_nodeValue())){if(!t.hasNext())return r.get_nodeValue();var i=t.next();if(i.nodeType==E.PCData&&""==T.trim(i.get_nodeValue())&&!t.hasNext())return r.get_nodeValue()}throw S.thrown(D.get_name(e)+" does not only have data")}if(n.nodeType!=E.PCData&&n.nodeType!=E.CData)throw S.thrown(D.get_name(e)+" does not have data");return n.get_nodeValue()},C.__name__="haxe.xml.XmlParserException",C.prototype={toString:function(){return f.getClassName(f.getClass(this))+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},__class__:C},function(){}),R=(V.__name__="haxe.xml.Parser",V.parse=function(e,t){null==t&&(t=!1);var n=E.createDocument();return V.doParse(e,t,0,n),n},V.doParse=function(e,t,n,r){null==n&&(n=0);for(var i=null,a=1,s=1,o=null,u=0,l=0,c=0,h=new x,_=1,d=-1;n<e.length;){var f,p,g=T.unsafeCodeAt(e,n);switch(a){case 0:switch(g){case 9:case 10:case 13:case 32:break;default:a=s;continue}break;case 1:if(60!=g){u=n,a=13;continue}a=0,s=2;break;case 2:switch(g){case 33:if(91==T.fastCodeAt(e,n+1)){if("CDATA["!=w.substr(e,n+=2,6).toUpperCase())throw S.thrown(new C("Expected <![CDATA[",e,n));a=17,u=(n+=5)+1}else if(68==T.fastCodeAt(e,n+1)||100==T.fastCodeAt(e,n+1)){if("OCTYPE"!=w.substr(e,n+2,6).toUpperCase())throw S.thrown(new C("Expected <!DOCTYPE",e,n));a=16,u=(n+=8)+1}else{if(45!=T.fastCodeAt(e,n+1)||45!=T.fastCodeAt(e,n+2))throw S.thrown(new C("Expected \x3c!--",e,n));a=15,u=(n+=2)+1}break;case 47:if(null==r)throw S.thrown(new C("Expected node name",e,n));u=n+1,a=0,s=10;break;case 63:a=14,u=n;break;default:a=3,u=n;continue}break;case 3:if(V.isValidChar(g))break;if(n==u)throw S.thrown(new C("Expected node name",e,n));i=E.createElement(w.substr(e,u,n-u)),r.addChild(i),++l,a=0,s=4;continue;case 4:switch(g){case 47:a=11;break;case 62:a=9;break;default:a=5,u=n;continue}break;case 5:if(V.isValidChar(g))break;if(u==n)throw S.thrown(new C("Expected attribute name",e,n));o=w.substr(e,u,n-u);if(i.exists(o))throw S.thrown(new C("Duplicate attribute ["+o+"]",e,n));a=0,s=6;continue;case 6:if(61!=g)throw S.thrown(new C("Expected =",e,n));a=0,s=7;break;case 7:switch(g){case 34:case 39:h=new x,a=8,u=n+1,d=g;break;default:throw S.thrown(new C('Expected "',e,n))}break;case 8:switch(g){case 38:h.addSub(e,u,n-u),a=18,_=8,u=n+1;break;case 60:case 62:if(t)throw S.thrown(new C("Invalid unescaped "+String.fromCodePoint(g)+" in attribute value",e,n));g==d&&(h.addSub(e,u,n-u),f=h.toString(),h=new x,i.set(o,f),a=0,s=4);break;default:g==d&&(h.addSub(e,u,n-u),f=h.toString(),h=new x,i.set(o,f),a=0,s=4)}break;case 9:u=n=V.doParse(e,t,n,i),a=1;break;case 10:if(V.isValidChar(g))break;if(u==n)throw S.thrown(new C("Expected node name",e,n));var m=w.substr(e,u,n-u);if(null==r||0!=r.nodeType)throw S.thrown(new C("Unexpected </"+m+">, tag is not open",e,n));if(m!=r.get_nodeName())throw S.thrown(new C("Expected </"+r.get_nodeName()+">",e,n));a=0,s=12;continue;case 11:if(62!=g)throw S.thrown(new C("Expected >",e,n));a=1;break;case 12:if(62==g)return 0==l&&r.addChild(E.createPCData("")),n;throw S.thrown(new C("Expected >",e,n));case 13:60==g?(h.addSub(e,u,n-u),m=E.createPCData(h.toString()),h=new x,r.addChild(m),++l,a=0,s=2):38==g&&(h.addSub(e,u,n-u),a=18,_=13,u=n+1);break;case 14:63==g&&62==T.fastCodeAt(e,n+1)&&(p=w.substr(e,u+1,++n-u-2),r.addChild(E.createProcessingInstruction(p)),++l,a=1);break;case 15:45==g&&45==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(r.addChild(E.createComment(w.substr(e,u,n-u))),++l,n+=2,a=1);break;case 16:91==g?++c:93==g?--c:62==g&&0==c&&(r.addChild(E.createDocType(w.substr(e,u,n-u))),++l,a=1);break;case 17:93==g&&93==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(p=E.createCData(w.substr(e,u,n-u)),r.addChild(p),++l,n+=2,a=1);break;case 18:if(59==g){var v=w.substr(e,u,n-u);if(35==T.fastCodeAt(v,0)){var y=120==T.fastCodeAt(v,1)?b.parseInt("0"+w.substr(v,1,v.length-1)):b.parseInt(w.substr(v,1,v.length-1));h.addChar(y)}else if(V.escapes.exists(v))h.add(V.escapes.get(v));else{if(t)throw S.thrown(new C("Undefined entity: "+v,e,n));h.add("&"+v+";")}u=n+1,a=_}else if(!V.isValidChar(g)&&35!=g){if(t)throw S.thrown(new C("Invalid character in entity: "+String.fromCodePoint(g),e,n));h.addChar(38),h.addSub(e,u,n-u),u=--n+1,a=_}}++n}if(1==a&&(u=n,a=13),13==a){if(0==r.nodeType)throw S.thrown(new C("Unclosed node <"+r.get_nodeName()+">",e,n));n==u&&0!=l||(h.addSub(e,u,n-u),r.addChild(E.createPCData(h.toString())),++l)}else{if(t||18!=a||13!=_)throw S.thrown(new C("Unexpected end",e,n));h.addChar(38),h.addSub(e,u,n-u),r.addChild(E.createPCData(h.toString())),++l}return n},V.isValidChar=function(e){return 97<=e&&e<=122||65<=e&&e<=90||48<=e&&e<=57||58==e||46==e||95==e||45==e},function(e){this.output=new x,this.pretty=e}),O=(R.__name__="haxe.xml.Printer",R.print=function(e,t){t=new R(t=null==t?!1:t);return t.writeNode(e,""),t.output.toString()},R.prototype={writeNode:function(e,t){switch(e.nodeType){case 0:this.write(t+"<"),this.write(e.get_nodeName());for(var n=e.attributes();n.hasNext();){var r=n.next();this.write(" "+r+'="'),this.write(T.htmlEscape(e.get(r),!0)),this.write('"')}if(this.hasChildren(e)){this.write(">"),this.newline();for(var i=e.iterator();i.hasNext();){var a=i.next();this.writeNode(a,this.pretty?t+"\t":t)}this.write(t+"</"),this.write(e.get_nodeName()),this.write(">")}else this.write("/>");this.newline();break;case 1:var s=e.get_nodeValue();0!=s.length&&(this.write(t+T.htmlEscape(s)),this.newline());break;case 2:this.write(t+"<![CDATA["),this.write(e.get_nodeValue()),this.write("]]>"),this.newline();break;case 3:s=e.get_nodeValue();s="\x3c!--"+new q("[\n\r\t]+","g").replace(s,"")+"--\x3e",this.write(t),this.write(T.trim(s)),this.newline();break;case 4:this.write("<!DOCTYPE "+e.get_nodeValue()+">"),this.newline();break;case 5:this.write("<?"+e.get_nodeValue()+"?>"),this.newline();break;case 6:for(i=e.iterator();i.hasNext();){a=i.next();this.writeNode(a,t)}}},write:function(e){this.output.add(e)},newline:function(){this.pretty&&this.output.add("\n")},hasChildren:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();switch(n.nodeType){case 0:case 1:return!0;case 2:case 3:if(0!=T.ltrim(n.get_nodeValue()).length)return!0}}return!1},__class__:R},function(){}),Z=(O.__name__="js.Boot",O.isClass=function(e){return e.__name__},O.isEnum=function(e){return e.__ename__},O.getClass=function(e){var t;return null==e?null:e instanceof Array?Array:null!=(t=e.__class__)?t:null!=(t=O.__nativeClassName(e))?O.__resolveNativeClass(t):null},O.__string_rec=function(i,a){if(null==i)return"null";if(5<=a.length)return"<...>";var s,e,t=typeof i;switch(t="function"==t&&(O.isClass(i)||O.isEnum(i))?"object":t){case"function":return"<function>";case"object":if(i.__enum__)return l=(s=F[i.__enum__].__constructs__[i._hx_index])._hx_name,s.__params__?(a+="\t",l+"("+function(){for(var e=[],t=0,n=s.__params__;t<n.length;){var r=n[t];t+=1,e.push(O.__string_rec(i[r],a))}return e}().join(",")+")"):l;if(i instanceof Array){for(var n="[",r=(a+="\t",0),o=i.length;r<o;){var u=r++;n+=(0<u?",":"")+O.__string_rec(i[u],a)}return n+="]"}try{e=i.toString}catch(r){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e){var l=i.toString();if("[object Object]"!=l)return l}var n="{\n",c=(a+="\t",null!=i.hasOwnProperty),h=null;for(h in i)c&&!i.hasOwnProperty(h)||"prototype"!=h&&"__class__"!=h&&"__super__"!=h&&"__interfaces__"!=h&&"__properties__"!=h&&(2!=n.length&&(n+=", \n"),n+=a+h+" : "+O.__string_rec(i[h],a));return n+="\n"+(a=a.substring(1))+"}";case"string":return i;default:return String(i)}},O.__nativeClassName=function(e){e=O.__toStr.call(e).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},O.__resolveNativeClass=function(e){return L[e]},function(){}),P=(Z.__name__="js.Lib",Z.get_undefined=function(){},function(){});function ee(e,t){var n;return null==t?null:(null==t.__id__&&(t.__id__=L.$haxeUID++),null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__],null==n&&(n=t.bind(e),e.hx__closures__[t.__id__]=n),n)}P.__name__="kadabra.utils.XMLUtils",P.getFloat=function(e,t,n){return null==n&&(n=0),k.resolve(D.get_has(e),t)?b.parseFloat(A.resolve(D.get_att(e),t)):n},P.getInt=function(e,t,n){return null==n&&(n=0),k.resolve(D.get_has(e),t)?b.parseInt(A.resolve(D.get_att(e),t)):n},P.getBool=function(e,t,n){return null==n&&(n=!0),k.resolve(D.get_has(e),t)?"true"==A.resolve(D.get_att(e),t):n},P.getString=function(e,t,n){return null==n&&(n=""),k.resolve(D.get_has(e),t)?A.resolve(D.get_att(e),t):n},P.getFirstChild=function(e){for(var t=null,n=D.get_elements(e);n.hasNext();){t=n.next();break}return t},L.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(w.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),(String.prototype.__class__=String).__name__="String",Array.__name__="Array",O.__toStr={}.toString,E.Element=0,E.PCData=1,E.CData=2,E.Comment=3,E.DocType=4,E.ProcessingInstruction=5,E.Document=6,B.EXIT="$$EXIT$$",_.helperList=new r,d.GREATER=">",d.LOWER="<",d.GREATER_EQUAL=">=",d.LOWER_EQUAL="<=",d.EQUAL="=",d.DIFFERENT="!",d.NOT_IN="!in",d.IN="in",V.escapes=((e=new r).set("lt","<"),e.set("gt",">"),e.set("amp","&"),e.set("quot",'"'),e.set("apos","'"),e)}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);