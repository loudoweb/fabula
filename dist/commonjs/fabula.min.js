// Fabula version 0.11.0 generated by Haxe
!function(e,R){"use strict";e.fabula=e.fabula||{};function t(){return P.__string_rec(this,"")}var U,d={};function n(e,t){var n,i=Object.create(e);for(n in t)i[n]=t[n];return t.toString!==Object.prototype.toString&&(i.toString=t.toString),i}function F(e,t){this.r=new RegExp(e,t.split("u").join(""))}function b(){}function r(){}function w(){}function C(){this.b=""}F.__name__="EReg",F.prototype={replace:function(e,t){return e.replace(this.r,t)},__class__:F},b.__name__="HxOverrides",b.cca=function(e,t){e=e.charCodeAt(t);return e!=e?K.get_undefined():e},b.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},b.remove=function(e,t){t=e.indexOf(t);return-1!=t&&(e.splice(t,1),!0)},b.now=function(){return Date.now()},Math.__name__="Math",r.__name__="Reflect",r.field=function(e,t){try{return e[t]}catch(e){return null}},r.callMethod=function(e,t,n){return t.apply(e,n)},r.isFunction=function(e){return"function"==typeof e&&!(P.isClass(e)||P.isEnum(e))},w.__name__="Std",w.string=function(e){return P.__string_rec(e,"")},w.parseInt=function(e){if(null!=e)for(var t=0,n=e.length;t<n;){var i=t++,r=T.fastCodeAt(e,i);if(r<=8||14<=r&&32!=r&&45!=r)return r=T.fastCodeAt(e,1+i),i=parseInt(e,120==r||88==r?16:10),isNaN(i)?null:i}return null},w.parseFloat=function(e){return parseFloat(e)};function f(){}function E(e){this.nodeType=e,this.children=[],this.attributeMap=new s}function p(e,t,n,i,r,o){null==o&&(o=!1),this.id=e,this.text=""!=t&&null!=t?t:e,this.type=n,this.target=r,this.condition=i,this.isExit=o,c.helperList.set(this.id,S.EVENT)}function q(e,t,n,i,r,o,a,s,u,l){null==o&&(o=!1),null==r&&(r=1),null==i&&(i=!1),this.id=e,this.text=t,this.conditions=n,this.isExit=i,this.once=o,this.count=0,this.speaker=a,this.listeners=s,this.environment=u,this.target=l,c.helperList.set(this.id,S.EVENT)}function o(e,t,n){null==n&&(n=!0),this.condition=e,this.type=t,this._affirmation=n}function l(){this.condition=[],o.call(this,this.condition,null)}function a(e,t,n){null==n&&(n=!0),this._achievedListID=t,o.call(this,e,S.EVENT,n)}function i(e,t,n){this.id=e,this.type=t,this.set(n),this.startingValue=this.value,c.helperList.set(this.id,S.VARIABLE)}function x(e,t,n){this.xml=t,this.message=e,this.position=n,this.lineNumber=1;for(var i=this.positionAtLine=0,r=n;i<r;){var o=i++,o=T.fastCodeAt(t,o);10==o?(this.lineNumber++,this.positionAtLine=0):13!=o&&this.positionAtLine++}}C.__name__="StringBuf",C.prototype={add:function(e){this.b+=w.string(e)},addChar:function(e){this.b+=String.fromCodePoint(e)},addSub:function(e,t,n){this.b+=b.substr(e,t,null==n?null:n)},toString:function(){return this.b},__class__:C};var T=function(){},g=(T.__name__="StringTools",T.htmlEscape=function(e,t){for(var n=new C,i=new X(e);i.hasNext();){var r=i.next();switch(r){case 34:t?n.add("&quot;"):n.addChar(r);break;case 38:n.add("&amp;");break;case 39:t?n.add("&#039;"):n.addChar(r);break;case 60:n.add("&lt;");break;case 62:n.add("&gt;");break;default:n.addChar(r)}}return n.toString()},T.isSpace=function(e,t){e=b.cca(e,t);return 8<e&&e<14||32==e},T.ltrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,n);)++n;return 0<n?b.substr(e,n,t-n):e},T.rtrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,t-n-1);)++n;return 0<n?b.substr(e,0,t-n):e},T.trim=function(e){return T.ltrim(T.rtrim(e))},T.fastCodeAt=function(e,t){return e.charCodeAt(t)},T.isEof=function(e){return e!=e},T.utf16CodePointAt=function(e,t){var n=T.fastCodeAt(e,t);return n=55296<=n&&n<=56319?n-55232<<10|1023&T.fastCodeAt(e,t+1):n},f.__name__="Type",f.getClass=function(e){return P.getClass(e)},f.getClassName=function(e){return e.__name__},f.createEnum=function(e,t,n){var i=r.field(e,t);if(null==i)throw I.thrown("No such constructor "+t);if(r.isFunction(i)){if(null==n)throw I.thrown("Constructor "+t+" need parameters");return r.callMethod(e,i,n)}if(null!=n&&0!=n.length)throw I.thrown("Constructor "+t+" does not need parameters");return i},{}),v=(g.toString=function(e){switch(e){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}},E.__name__="Xml",E.parse=function(e){return V.parse(e)},E.createElement=function(e){var t=new E(E.Element);return t.set_nodeName(e),t},E.createPCData=function(e){var t=new E(E.PCData);return t.set_nodeValue(e),t},E.createCData=function(e){var t=new E(E.CData);return t.set_nodeValue(e),t},E.createComment=function(e){var t=new E(E.Comment);return t.set_nodeValue(e),t},E.createDocType=function(e){var t=new E(E.DocType);return t.set_nodeValue(e),t},E.createProcessingInstruction=function(e){var t=new E(E.ProcessingInstruction);return t.set_nodeValue(e),t},E.createDocument=function(){return new E(E.Document)},E.prototype={get_nodeName:function(){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.nodeName},set_nodeName:function(e){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.nodeName=e},get_nodeValue:function(){if(this.nodeType==E.Document||this.nodeType==E.Element)throw I.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.nodeValue},set_nodeValue:function(e){if(this.nodeType==E.Document||this.nodeType==E.Element)throw I.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.nodeValue=e},get:function(e){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.attributeMap.get(e)},set:function(e,t){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));this.attributeMap.set(e,t)},exists:function(e){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.attributeMap.exists(e)},attributes:function(){if(this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":g.toString(this.nodeType)));return this.attributeMap.keys()},iterator:function(){return this.ensureElementType(),new D(this.children)},elements:function(){this.ensureElementType();for(var e=[],t=0,n=this.children;t<n.length;){var i=n[t];++t,i.nodeType==E.Element&&e.push(i)}return new D(e)},elementsNamed:function(e){this.ensureElementType();for(var t=[],n=0,i=this.children;n<i.length;){var r=i[n];++n,r.nodeType==E.Element&&r.get_nodeName()==e&&t.push(r)}return new D(t)},firstElement:function(){this.ensureElementType();for(var e=0,t=this.children;e<t.length;){var n=t[e];if(++e,n.nodeType==E.Element)return n}return null},addChild:function(e){this.ensureElementType(),null!=e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this},removeChild:function(e){return this.ensureElementType(),!!b.remove(this.children,e)&&!(e.parent=null)},toString:function(){return O.print(this)},ensureElementType:function(){if(this.nodeType!=E.Document&&this.nodeType!=E.Element)throw I.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":g.toString(this.nodeType)))},__class__:E},p.__name__="fabula.Choice",p.prototype={__class__:p},q.__name__="fabula.Event",q.prototype={getChoices:function(){if(this._cacheChoices=[],null!=this.choices)for(var e=0,t=this.choices.length;e<t;){var n=e++;null!=this.choices[n].condition&&!this.choices[n].condition.test()||this._cacheChoices.push(this.choices[n])}return 0==this._cacheChoices.length&&(this.isExit?this._cacheChoices.push(new p("EXIT",v.QUIT,"quit",null,this.target,!0)):this._cacheChoices.push(new p("CONTINUE",v.CONTINUE,"continue",null,this.target))),this._cacheChoices},selectChoice:function(e,t,n){var i=(n=null==n?!1:n)?this.choices:this._cacheChoices;if(null!=i)if(null!=e)for(var r=0,o=i.length;r<o;){var a=r++;if(i[a].id==e)return i[a]}else if(null!=t)return i[t];return null},testConditions:function(){return null==this.conditions||this.conditions.test()},addChoice:function(e){null==this.choices&&(this.choices=[],this._cacheChoices=[]),this.choices.push(e)},__class__:q},d["fabula.EEventType"]={__ename__:!0,__constructs__:["QUEST","RANDOM_ENCOUNTER","SCENE"],QUEST:{_hx_index:0,__enum__:"fabula.EEventType",toString:t},RANDOM_ENCOUNTER:{_hx_index:1,__enum__:"fabula.EEventType",toString:t},SCENE:{_hx_index:2,__enum__:"fabula.EEventType",toString:t}},d["fabula.EPlayingType"]={__ename__:!0,__constructs__:["SEQUENCE","DRAW"],SEQUENCE:{_hx_index:0,__enum__:"fabula.EPlayingType",toString:t},DRAW:{_hx_index:1,__enum__:"fabula.EPlayingType",toString:t}},e.fabula.Fabula=function(e,t){this._questsID=[],this._encountersID=[],this._textsID=[],this.achievedListID=[],this._achievedCallback=t,this.conditionFactory=new c(this),this._sequences=[];for(var n=0;n<e.length;){var i=e[n];++n,this.init(i)}}),m=(v.__name__="fabula.Fabula",v.prototype={init:function(e){e=m.parse(e,this.conditionFactory,this.achievedListID);this.arrayMerge(this._sequences,e.sequences)},arrayMerge:function(e,t){for(var n=0,i=t.length;n<i;){var r=n++;e.push(t[r])}},mapMerge:function(e,t){for(var n=t.keyValueIterator();n.hasNext();){var i=n.next(),r=i.key,i=i.value;e.set(r,i)}},reset:function(){this.achievedListID.splice(0,this.achievedListID.length);for(var e=0,t=this._sequences;e<t.length;){var n=t[e];if(++e,null!=n.variables)for(var i=0,r=n.variables.length;i<r;){var o=i++;n.variables[o].reset()}}},selectSequence:function(e,t){null==t&&(t=!0);for(var n=0,i=this._sequences.length;n<i;){var r=n++;if(this._sequences[r].id==e){r=this._sequences[r];if(t){if(null!=r.conditions&&!r.conditions.test())return null;this.currentSequence=r,this.currentSequence.start()}return r}}return null},getNextEvent:function(){var e=this.currentSequence.getNextEvent();return null!=e&&(this.achievedListID.push(e.id),null!=this._achievedCallback)&&this._achievedCallback(e.id),e},getCurrentEvent:function(){return this.currentSequence.getEvent()},selectChoice:function(e,t){var n=null;return null!=this.currentSequence&&this.currentSequence.current<this.currentSequence.events.length&&(n=this.currentSequence.getEvent().selectChoice(e,t),this.currentSequence.nextTarget=n.isExit?"$$EXIT$$":n.target),null!=n&&(this.achievedListID.push(e),null!=this._achievedCallback)&&this._achievedCallback(e),n},getVar:function(e){if(null!=this.currentSequence){e=M.get(this.currentSequence.variables,e);if(null!=e)return e}return null},updateVar:function(){},countWords:function(){for(var e=0,t=0,n=this._sequences;t<n.length;){var i=n[t];if(++t,null!=i.events)for(var r=0,o=i.events;r<o.length;){var a=o[r];if(++r,e+=a.text.split(" ").length,null!=a.choices)for(var s=0,u=a.choices;s<u.length;){var l=u[s];++s,e+=l.text.split(" ").length}}}return e},__class__:v},function(){}),y=(m.__name__="fabula.FabulaXmlParser",m.parse=function(e,t,n){m._conditionFactory=t;t=E.parse(e).firstElement();if(t.nodeType!=E.Document&&t.nodeType!=E.Element)throw I.thrown("Invalid nodeType "+(null==t.nodeType?"null":g.toString(t.nodeType)));m._xml=t;for(var i=[],r=0,o=W.resolve(m._xml,"sequence");r<o.length;){var a=o[r];if(++r,k.resolve(a,"id")){var s=A.resolve(a,"id"),u=(m.ID_GEN_HELPER=s,m.ID_GEN_COUNT=0,[]),l=[],s=new y(s),a=(s.addConditions(m._conditionFactory.create(L.getString(a,"if"))),m.parseEvents(a,s,u,l));if(null!=a)if(console.log("fabula/FabulaXmlParser.hx:49:",a.id),null!=a.choices)for(var c=0,h=a.choices;c<h.length;){var _=h[c];++c,null==_.target&&(_.isExit=!0)}else a.isExit=!0;s.addSequence(u,l),i.push(s)}else console.log("fabula/FabulaXmlParser.hx:32:","id attribute is mandatory in the sequence tag")}if(H.resolve(m._xml,"words"))for(var d=W.resolve(m._xml,"words")[0].elements();d.hasNext();){var f=d.next();switch((f.nodeType==E.Document?"Document":f.get_nodeName()).toUpperCase()){case"CONTINUE":v.CONTINUE=Y.get_innerData(f);break;case"QUIT":v.QUIT=Y.get_innerData(f)}}for(r=0,o=W.resolve(m._xml,"list");r<o.length;){o[r];++r,console.log("fabula/FabulaXmlParser.hx:86:","coucou list")}return{sequences:i}},m.parseEvents=function(e,t,n,i,r){var o=null,a=e.elements();e:for(;a.hasNext();){var s=a.next();switch(s.nodeType==E.Document?"Document":s.get_nodeName()){case"choice":if(null==o){console.log("fabula/FabulaXmlParser.hx:148:","impossible to add a choice without a parent event");break e}o.addChoice(new p(L.getString(s,"id",m.ID_GEN_HELPER+"_C"+ ++m.ID_GEN_COUNT),m.getText(s),L.getString(s,"type"),m._conditionFactory.create(L.getString(s,"if")),L.getString(s,"target"),L.getBool(s,"exit",o.isExit)));break;case"event":var u,l=L.getString(s,"id",m.ID_GEN_HELPER+"_E"+ ++m.ID_GEN_COUNT);if(null==r?u=L.getString(s,"if"):(u=r.id,r.target=l),o=new q(l,m.getText(s),m._conditionFactory.create(u),L.getBool(s,"exit",!1),L.getInt(s,"weight",1),L.getBool(s,"once",!1),L.getString(s,"speaker"),L.getString(s,"listeners"),L.getString(s,"environment"),L.getString(s,"target")),H.resolve(s,"choice"))for(var c=0,h=W.resolve(s,"choice");c<h.length;){var _=h[c],d=(++c,new p(L.getString(_,"id",m.ID_GEN_HELPER+"_C"+ ++m.ID_GEN_COUNT),m.getText(_),L.getString(_,"type"),m._conditionFactory.create(L.getString(_,"if")),L.getString(_,"target"),L.getBool(_,"exit",o.isExit)));o.addChoice(d),H.resolve(_,"event")&&m.parseEvents(_,t,n,i,d)}(null==r?n:i).push(o);break;case"variable":t.addVariable(A.resolve(s,"id"),f.createEnum(B,A.resolve(s,"type").toUpperCase()),A.resolve(s,"value"))}}return o},m.getText=function(e){var t=L.getString(e,"text");return t=""==t&&H.resolve(e,"text")?Y.get_innerData(Q.resolve(e,"text")):t},function(e){this.id=e,this.current=-1,this.currentId=null,this.numCompleted=0,this.nextTarget=null}),s=(y.__name__="fabula.Sequence",y.prototype={addConditions:function(e){this.conditions=e},addVariable:function(e,t,n){switch(null==this.variables&&(this.variables=[]),t._hx_index){case 0:this.variables.push(new G(e,n));break;case 1:this.variables.push(new j(e,n));break;case 2:this.variables.push(new N(e,n))}},addSequence:function(e,t){null==this.events&&null==this.branches||console.log("fabula/Sequence.hx:62:","WARNING a new sequence will replace an old sequence"),this.events=e,this.branches=t},start:function(){if(this.current=-1,this.nextTarget=null,(this.currentId=null)!=this.variables)for(var e=0,t=this.variables.length;e<t;){var n=e++;this.variables[n].reset()}},getNextEvent:function(e){if(!(e=null==e?!1:e)&&-1<this.current&&this.current<this.events.length&&(this.events[this.current].isExit||"$$EXIT$$"==this.nextTarget))this.numCompleted++,console.log("fabula/Sequence.hx:94:","[Fabula] sequence completed");else if(this.current+1<=this.events.length){if(0<=this.current){if(null!=this.nextTarget&&""!=this.nextTarget)return e=this.nextTarget,this.nextTarget=null,this.getEvent(e);if(null!=this.events[this.current].target&&""!=this.events[this.current].target)return this.getEvent(this.events[this.current].target)}if(this.current++,this.current<this.events.length)return(e=this.events[this.current]).testConditions()?(this.currentId=e.id,e):this.getNextEvent(!0);this.numCompleted++,console.log("fabula/Sequence.hx:128:","sequence completed")}return null},getEvent:function(e){null==e&&(e=this.currentId);for(var t=0,n=this.events.length;t<n;){var i=t++;if(this.events[i].id==e)return this.current=i,this.currentId=e,this.events[i]}for(t=0,n=this.branches.length;t<n;){i=t++;if(this.branches[i].id==e)return this.currentId=e,this.branches[i]}return null},__class__:y},o.__name__="fabula.condition.Condition",o.prototype={test:function(){throw I.thrown("[Condition] Override test function")},__class__:o},l.__name__="fabula.condition.ConditionCollection",l.__super__=o,l.prototype=n(o.prototype,{add:function(e){this.condition.push(e)},test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,!n.test())return!1}return!0},hasType:function(e){for(var t=0,n=this.condition;t<n.length;){var i=n[t];if(++t,i.type==e)return!0}return!1},hasOnlyTypes:function(e){for(var t=0,n=this.condition;t<n.length;){var i=n[t];if(++t,null==i.type){if(!i.hasOnlyTypes(e))return!1}else if(-1==e.indexOf(i.type))return!1}return!0},__class__:l}),a.__name__="fabula.condition.ConditionEvent",a.__super__=o,a.prototype=n(o.prototype,{test:function(){for(var e=0,t=this._achievedListID;e<t.length;){var n=t[e];if(++e,n==this.condition)return this._affirmation}return!this._affirmation},__class__:a}),function(){this.h=Object.create(null)}),c=(s.__name__="haxe.ds.StringMap",s.keysIterator=function(e){var t=Object.keys(e),n=t.length,i=0;return{hasNext:function(){return i<n},next:function(){return t[(i+=1)-1]}}},s.kvIterator=function(t){var n=Object.keys(t),e=n.length,i=0;return{hasNext:function(){return i<e},next:function(){var e=n[(i+=1)-1];return{key:e,value:t[e]}}}},s.prototype={exists:function(e){return Object.prototype.hasOwnProperty.call(this.h,e)},get:function(e){return this.h[e]},set:function(e,t){this.h[e]=t},keys:function(){return s.keysIterator(this.h)},keyValueIterator:function(){return s.kvIterator(this.h)},__class__:s},function(e){this.fabula=e}),h=(c.__name__="fabula.condition.ConditionFactory",c.prototype={create:function(e){if(""==e)return null;for(var t=new l,n=-1!=e.indexOf(",")?e.split(","):e.split("&"),i=0;i<n.length;){var r=n[i];if(++i,-1!=r.indexOf("|")){for(var o=new h,a=r.split("|"),s=0;s<a.length;){var u=a[s];++s,this.addToCollection(o,u)}t.add(o)}else this.addToCollection(t,r)}return t},addToCollection:function(e,t){var n=0==t.indexOf("!"),i=(t=n?b.substr(t,1,null):t).split("="),r=t;if(1<i.length&&(t=i[0],r=i[1]),c.helperList.exists(t)){i=c.helperList.get(t);if(null==i)throw I.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type");switch(i._hx_index){case 0:e.add(new a(t,this.fabula.achievedListID,!n));break;case 1:e.add(new u(t,r,function(e,t){if(null==t)return null;null==t.__id__&&(t.__id__=R.$haxeUID++);var n;null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__];null==n&&(n=t.bind(e),e.hx__closures__[t.__id__]=n);return n}(U=this.fabula,U.getVar),!n));break;default:throw I.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type")}}else e.add(new a(t,this.fabula.achievedListID,!n))},__class__:c},function(){l.call(this)}),u=(h.__name__="fabula.condition.ConditionOr",h.__super__=l,h.prototype=n(l.prototype,{test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,n.test())return!0}return!1},__class__:h}),function(e,t,n,i){null==i&&(i=!0),this._getVar=n,this._operation=_.fromString(t.charAt(0)),null!=this._operation?this._targetValue=b.substr(t,1,null):(this._affirmation?this._operation="=":this._operation="!",this._targetValue=t),o.call(this,e,S.VARIABLE,i)}),_=(u.__name__="fabula.condition.ConditionVariable",u.__super__=o,u.prototype=n(o.prototype,{test:function(){var e=this._getVar(this.condition),t=e.convert(this._targetValue);switch(this._operation){case"!":return e.value!=t;case"=":return e.value==t;default:return!1}},__class__:u}),{}),S=(_.fromString=function(e){switch(e){case"!":return"!";case"!in":return"!in";case"<":return"<";case"<=":return"<=";case"=":return"=";case">":return">";case">=":return">=";case"in":return"in";default:return null}},d["fabula.condition.EConditionType"]={__ename__:!0,__constructs__:["EVENT","VARIABLE","INVENTORY","HAS_CHARACTER","IS_CHARACTER","TRAIT","ATTRIBUTS","SKILLS","CUSTOM"],EVENT:{_hx_index:0,__enum__:"fabula.condition.EConditionType",toString:t},VARIABLE:{_hx_index:1,__enum__:"fabula.condition.EConditionType",toString:t},INVENTORY:{_hx_index:2,__enum__:"fabula.condition.EConditionType",toString:t},HAS_CHARACTER:{_hx_index:3,__enum__:"fabula.condition.EConditionType",toString:t},IS_CHARACTER:{_hx_index:4,__enum__:"fabula.condition.EConditionType",toString:t},TRAIT:{_hx_index:5,__enum__:"fabula.condition.EConditionType",toString:t},ATTRIBUTS:{_hx_index:6,__enum__:"fabula.condition.EConditionType",toString:t},SKILLS:{_hx_index:7,__enum__:"fabula.condition.EConditionType",toString:t},CUSTOM:((U=function(e){return{_hx_index:8,type:e,__enum__:"fabula.condition.EConditionType",toString:t}}).__params__=["type"],U)}),B=d["fabula.condition.EVariableType"]={__ename__:!0,__constructs__:["STRING","INT","FLOAT"],STRING:{_hx_index:0,__enum__:"fabula.condition.EVariableType",toString:t},INT:{_hx_index:1,__enum__:"fabula.condition.EVariableType",toString:t},FLOAT:{_hx_index:2,__enum__:"fabula.condition.EVariableType",toString:t}},M=(i.__name__="fabula.condition.Variable",i.prototype={set:function(e){throw I.thrown("[Fabula > variable] This method needs to be overriden")},convert:function(e){throw I.thrown("[Fabula > variable] This method needs to be overriden")},reset:function(){this.value=this.startingValue},toString:function(){return"[var "+this.id+" : v:"+w.string(this.value)+", d:"+w.string(this.startingValue)+"]"},__class__:i},{}),N=(M._new=function(){return[]},M.getUserByIndex=function(e,t){return e[t]},M.get=function(e,t){for(var n=0;n<e.length;){var i=e[n];if(++n,i.id==t)return i}return null},function(e,t){i.call(this,e,B.FLOAT,t)}),j=(N.__name__="fabula.condition.VariableFloat",N.__super__=i,N.prototype=n(i.prototype,{set:function(e){var t=this.value;return this.value=w.parseFloat(e),t!=this.value},convert:function(e){return w.parseFloat(e)},__class__:N}),function(e,t){i.call(this,e,B.INT,t)}),G=(j.__name__="fabula.condition.VariableInt",j.__super__=i,j.prototype=n(i.prototype,{set:function(e){var t=this.value;return this.value=w.parseInt(e),t!=this.value},convert:function(e){return w.parseInt(e)},__class__:j}),function(e,t){i.call(this,e,B.STRING,t)}),I=(G.__name__="fabula.condition.VariableString",G.__super__=i,G.prototype=n(i.prototype,{set:function(e){var t=this.value;return this.value=e,t!=this.value},convert:function(e){return e},__class__:G}),function(e,t,n){Error.call(this,e),this.message=e,this.__previousException=t,this.__nativeException=null!=n?n:this}),$=(I.__name__="haxe.Exception",I.thrown=function(e){return e instanceof I?e.get_native():e instanceof Error?e:new $(e)},I.__super__=Error,I.prototype=n(Error.prototype,{__shiftStack:function(){this.__skipStack++},get_native:function(){return this.__nativeException},__class__:I}),function(e,t,n){I.call(this,String(e),t,n),this.value=e,this.__shiftStack()}),D=($.__name__="haxe.ValueException",$.__super__=I,$.prototype=n(I.prototype,{__class__:$}),function(e){this.current=0,this.array=e}),X=(D.__name__="haxe.iterators.ArrayIterator",D.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:D},function(e){this.offset=0,this.s=e}),Q=(X.__name__="haxe.iterators.StringIteratorUnicode",X.prototype={hasNext:function(){return this.offset<this.s.length},next:function(){var e=T.utf16CodePointAt(this.s,this.offset++);return 65536<=e&&this.offset++,e},__class__:X},{}),A=(Q.resolve=function(e,t){var n,i=e.elementsNamed(t).next();if(null==i)throw n=e.nodeType==E.Document?"Document":e.get_nodeName(),I.thrown(n+" is missing element "+t);if(i.nodeType!=E.Document&&i.nodeType!=E.Element)throw I.thrown("Invalid nodeType "+(null==i.nodeType?"null":g.toString(i.nodeType)));return e=i},{}),k=(A.resolve=function(e,t){if(e.nodeType==E.Document)throw I.thrown("Cannot access document attribute "+t);var n=e.get(t);if(null==n)throw I.thrown(e.get_nodeName()+" is missing attribute "+t);return n},{}),H=(k.resolve=function(e,t){if(e.nodeType==E.Document)throw I.thrown("Cannot access document attribute "+t);return e.exists(t)},{}),W=(H.resolve=function(e,t){return e.elementsNamed(t).hasNext()},{}),Y=(W.resolve=function(e,t){for(var n=[],i=e.elementsNamed(t);i.hasNext();){var r=i.next();if(r.nodeType!=E.Document&&r.nodeType!=E.Element)throw I.thrown("Invalid nodeType "+(null==r.nodeType?"null":g.toString(r.nodeType)));e=r;n.push(e)}return n},{}),V=(Y.get_innerData=function(e){var t=e.iterator();if(!t.hasNext())throw I.thrown((e.nodeType==E.Document?"Document":e.get_nodeName())+" does not have data");var n=t.next();if(t.hasNext()){var i=t.next();if(n.nodeType==E.PCData&&i.nodeType==E.CData&&""==T.trim(n.get_nodeValue())){if(!t.hasNext())return i.get_nodeValue();var r=t.next();if(r.nodeType==E.PCData&&""==T.trim(r.get_nodeValue())&&!t.hasNext())return i.get_nodeValue()}throw I.thrown((e.nodeType==E.Document?"Document":e.get_nodeName())+" does not only have data")}if(n.nodeType!=E.PCData&&n.nodeType!=E.CData)throw I.thrown((e.nodeType==E.Document?"Document":e.get_nodeName())+" does not have data");return n.get_nodeValue()},x.__name__="haxe.xml.XmlParserException",x.prototype={toString:function(){return f.getClassName(f.getClass(this))+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},__class__:x},function(){}),O=(V.__name__="haxe.xml.Parser",V.parse=function(e,t){null==t&&(t=!1);var n=E.createDocument();return V.doParse(e,t,0,n),n},V.doParse=function(e,t,n,i){for(var r,o,a=null,s=1,u=1,l=null,c=0,h=0,_=0,d=T.fastCodeAt(e,n=null==n?0:n),f=new C,p=1,g=-1;!T.isEof(d);){switch(s){case 0:switch(d){case 9:case 10:case 13:case 32:break;default:s=u;continue}break;case 1:if(60!=d){c=n,s=13;continue}s=0,u=2;break;case 2:switch(d){case 33:if(91==T.fastCodeAt(e,n+1)){if("CDATA["!=b.substr(e,n+=2,6).toUpperCase())throw I.thrown(new x("Expected <![CDATA[",e,n));s=17,c=(n+=5)+1}else if(68==T.fastCodeAt(e,n+1)||100==T.fastCodeAt(e,n+1)){if("OCTYPE"!=b.substr(e,n+2,6).toUpperCase())throw I.thrown(new x("Expected <!DOCTYPE",e,n));s=16,c=(n+=8)+1}else{if(45!=T.fastCodeAt(e,n+1)||45!=T.fastCodeAt(e,n+2))throw I.thrown(new x("Expected \x3c!--",e,n));s=15,c=(n+=2)+1}break;case 47:if(null==i)throw I.thrown(new x("Expected node name",e,n));c=n+1,s=0,u=10;break;case 63:s=14,c=n;break;default:s=3,c=n;continue}break;case 3:if(V.isValidChar(d))break;if(n==c)throw I.thrown(new x("Expected node name",e,n));a=E.createElement(b.substr(e,c,n-c)),i.addChild(a),++h,s=0,u=4;continue;case 4:switch(d){case 47:s=11;break;case 62:s=9;break;default:s=5,c=n;continue}break;case 5:if(V.isValidChar(d))break;if(c==n)throw I.thrown(new x("Expected attribute name",e,n));l=b.substr(e,c,n-c);if(a.exists(l))throw I.thrown(new x("Duplicate attribute ["+l+"]",e,n));s=0,u=6;continue;case 6:if(61!=d)throw I.thrown(new x("Expected =",e,n));s=0,u=7;break;case 7:switch(d){case 34:case 39:f=new C,s=8,c=n+1,g=d;break;default:throw I.thrown(new x('Expected "',e,n))}break;case 8:switch(d){case 38:f.addSub(e,c,n-c),s=18,p=8,c=n+1;break;case 60:case 62:if(t)throw I.thrown(new x("Invalid unescaped "+String.fromCodePoint(d)+" in attribute value",e,n));d==g&&(f.addSub(e,c,n-c),r=f.toString(),f=new C,a.set(l,r),s=0,u=4);break;default:d==g&&(f.addSub(e,c,n-c),r=f.toString(),f=new C,a.set(l,r),s=0,u=4)}break;case 9:c=n=V.doParse(e,t,n,a),s=1;break;case 10:if(V.isValidChar(d))break;if(c==n)throw I.thrown(new x("Expected node name",e,n));var v=b.substr(e,c,n-c);if(null==i||0!=i.nodeType)throw I.thrown(new x("Unexpected </"+v+">, tag is not open",e,n));if(v!=i.get_nodeName())throw I.thrown(new x("Expected </"+i.get_nodeName()+">",e,n));s=0,u=12;continue;case 11:if(62!=d)throw I.thrown(new x("Expected >",e,n));s=1;break;case 12:if(62==d)return 0==h&&i.addChild(E.createPCData("")),n;throw I.thrown(new x("Expected >",e,n));case 13:60==d?(f.addSub(e,c,n-c),v=E.createPCData(f.toString()),f=new C,i.addChild(v),++h,s=0,u=2):38==d&&(f.addSub(e,c,n-c),s=18,p=13,c=n+1);break;case 14:63==d&&62==T.fastCodeAt(e,n+1)&&(o=b.substr(e,c+1,++n-c-2),i.addChild(E.createProcessingInstruction(o)),++h,s=1);break;case 15:45==d&&45==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(i.addChild(E.createComment(b.substr(e,c,n-c))),++h,n+=2,s=1);break;case 16:91==d?++_:93==d?--_:62==d&&0==_&&(i.addChild(E.createDocType(b.substr(e,c,n-c))),++h,s=1);break;case 17:93==d&&93==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(o=E.createCData(b.substr(e,c,n-c)),i.addChild(o),++h,n+=2,s=1);break;case 18:if(59==d){var m=b.substr(e,c,n-c);if(35==T.fastCodeAt(m,0)){var y=120==T.fastCodeAt(m,1)?w.parseInt("0"+b.substr(m,1,m.length-1)):w.parseInt(b.substr(m,1,m.length-1));f.addChar(y)}else if(V.escapes.exists(m))f.add(V.escapes.get(m));else{if(t)throw I.thrown(new x("Undefined entity: "+m,e,n));f.add("&"+m+";")}c=n+1,s=p}else if(!V.isValidChar(d)&&35!=d){if(t)throw I.thrown(new x("Invalid character in entity: "+String.fromCodePoint(d),e,n));f.addChar(38),f.addSub(e,c,n-c),c=--n+1,s=p}}d=T.fastCodeAt(e,++n)}if(1==s&&(c=n,s=13),13==s){if(0==i.nodeType)throw I.thrown(new x("Unclosed node <"+i.get_nodeName()+">",e,n));n==c&&0!=h||(f.addSub(e,c,n-c),i.addChild(E.createPCData(f.toString())),++h)}else{if(t||18!=s||13!=p)throw I.thrown(new x("Unexpected end",e,n));f.addChar(38),f.addSub(e,c,n-c),i.addChild(E.createPCData(f.toString())),++h}return n},V.isValidChar=function(e){return 97<=e&&e<=122||65<=e&&e<=90||48<=e&&e<=57||58==e||46==e||95==e||45==e},function(e){this.output=new C,this.pretty=e}),P=(O.__name__="haxe.xml.Printer",O.print=function(e,t){t=new O(t=null==t?!1:t);return t.writeNode(e,""),t.output.toString()},O.prototype={writeNode:function(e,t){switch(e.nodeType){case 0:this.write(t+"<"),this.write(e.get_nodeName());for(var n=e.attributes();n.hasNext();){var i=n.next();this.write(" "+i+'="'),this.write(T.htmlEscape(e.get(i),!0)),this.write('"')}if(this.hasChildren(e)){this.write(">"),this.newline();for(var r=e.iterator();r.hasNext();){var o=r.next();this.writeNode(o,this.pretty?t+"\t":t)}this.write(t+"</"),this.write(e.get_nodeName()),this.write(">")}else this.write("/>");this.newline();break;case 1:var a=e.get_nodeValue();0!=a.length&&(this.write(t+T.htmlEscape(a)),this.newline());break;case 2:this.write(t+"<![CDATA["),this.write(e.get_nodeValue()),this.write("]]>"),this.newline();break;case 3:a=e.get_nodeValue();a="\x3c!--"+new F("[\n\r\t]+","g").replace(a,"")+"--\x3e",this.write(t),this.write(T.trim(a)),this.newline();break;case 4:this.write("<!DOCTYPE "+e.get_nodeValue()+">"),this.newline();break;case 5:this.write("<?"+e.get_nodeValue()+"?>"),this.newline();break;case 6:for(r=e.iterator();r.hasNext();){o=r.next();this.writeNode(o,t)}}},write:function(e){this.output.add(e)},newline:function(){this.pretty&&this.output.add("\n")},hasChildren:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();switch(n.nodeType){case 0:case 1:return!0;case 2:case 3:if(0!=T.ltrim(n.get_nodeValue()).length)return!0}}return!1},__class__:O},function(){}),K=(P.__name__="js.Boot",P.isClass=function(e){return e.__name__},P.isEnum=function(e){return e.__ename__},P.getClass=function(e){var t;return null==e?null:e instanceof Array?Array:null!=(t=e.__class__)?t:null!=(t=P.__nativeClassName(e))?P.__resolveNativeClass(t):null},P.__string_rec=function(r,o){if(null==r)return"null";if(5<=o.length)return"<...>";var e,a,t,n=typeof r;switch(n="function"==n&&(P.isClass(r)||P.isEnum(r))?"object":n){case"function":return"<function>";case"object":if(r.__enum__)return e=(c=d[r.__enum__]).__constructs__[r._hx_index],(a=c[e]).__params__?(o+="\t",e+"("+function(){for(var e=[],t=0,n=a.__params__;t<n.length;){var i=n[t];t+=1,e.push(P.__string_rec(r[i],o))}return e}().join(",")+")"):e;if(r instanceof Array){for(var i="[",s=(o+="\t",0),u=r.length;s<u;){var l=s++;i+=(0<l?",":"")+P.__string_rec(r[l],o)}return i+="]"}try{t=r.toString}catch(s){return"???"}if(null!=t&&t!=Object.toString&&"function"==typeof t){var c=r.toString();if("[object Object]"!=c)return c}var i="{\n",h=(o+="\t",null!=r.hasOwnProperty),_=null;for(_ in r)h&&!r.hasOwnProperty(_)||"prototype"!=_&&"__class__"!=_&&"__super__"!=_&&"__interfaces__"!=_&&"__properties__"!=_&&(2!=i.length&&(i+=", \n"),i+=o+_+" : "+P.__string_rec(r[_],o));return i+="\n"+(o=o.substring(1))+"}";case"string":return r;default:return String(r)}},P.__nativeClassName=function(e){e=P.__toStr.call(e).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},P.__resolveNativeClass=function(e){return R[e]},function(){}),L=(K.__name__="js.Lib",K.get_undefined=function(){},function(){});L.__name__="kadabra.utils.XMLUtils",L.getFloat=function(e,t,n){return null==n&&(n=0),k.resolve(e,t)?w.parseFloat(A.resolve(e,t)):n},L.getInt=function(e,t,n){return null==n&&(n=0),k.resolve(e,t)?w.parseInt(A.resolve(e,t)):n},L.getBool=function(e,t,n){return null==n&&(n=!0),k.resolve(e,t)?"true"==A.resolve(e,t):n},L.getString=function(e,t,n){return null==n&&(n=""),k.resolve(e,t)?A.resolve(e,t):n},L.getFirstChild=function(e){for(var t=null,n=e.elements();n.hasNext();){t=n.next();break}return t},R.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(b.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),(String.prototype.__class__=String).__name__="String",Array.__name__="Array",P.__toStr={}.toString,E.Element=0,E.PCData=1,E.CData=2,E.Comment=3,E.DocType=4,E.ProcessingInstruction=5,E.Document=6,v.CONTINUE="Continue",v.QUIT="Quit",y.EXIT="$$EXIT$$",c.helperList=new s,_.GREATER=">",_.LOWER="<",_.GREATER_EQUAL=">=",_.LOWER_EQUAL="<=",_.EQUAL="=",_.DIFFERENT="!",_.NOT_IN="!in",_.IN="in",V.escapes=((e=new s).set("lt","<"),e.set("gt",">"),e.set("amp","&"),e.set("quot",'"'),e.set("apos","'"),e)}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);