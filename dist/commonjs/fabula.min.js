// Fabula version 0.8.0 generated by Haxe
!function(e,O){"use strict";e.fabula=e.fabula||{};function t(){return q.__string_rec(this,"")}var o,F={};function n(e,t){var n,r=Object.create(e);for(n in t)r[n]=t[n];return t.toString!==Object.prototype.toString&&(r.toString=t.toString),r}function R(e,t){this.r=new RegExp(e,t.split("u").join(""))}function b(){}function i(){}function y(){}function C(){this.b=""}R.__name__="EReg",R.prototype={replace:function(e,t){return e.replace(this.r,t)},__class__:R},b.__name__="HxOverrides",b.cca=function(e,t){e=e.charCodeAt(t);return e!=e?J.get_undefined():e},b.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},b.remove=function(e,t){t=e.indexOf(t);return-1!=t&&(e.splice(t,1),!0)},b.now=function(){return Date.now()},Math.__name__="Math",i.__name__="Reflect",i.field=function(e,t){try{return e[t]}catch(e){return null}},i.callMethod=function(e,t,n){return t.apply(e,n)},i.isFunction=function(e){return"function"==typeof e&&!(q.isClass(e)||q.isEnum(e))},y.__name__="Std",y.string=function(e){return q.__string_rec(e,"")},y.parseInt=function(e){if(null!=e)for(var t=0,n=e.length;t<n;){var r=t++,i=S.fastCodeAt(e,r);if(i<=8||14<=i&&32!=i&&45!=i)return i=S.fastCodeAt(e,1+r),r=parseInt(e,120==i||88==i?16:10),isNaN(r)?null:r}return null},y.parseFloat=function(e){return parseFloat(e)};function w(){}function x(e){this.nodeType=e,this.children=[],this.attributeMap=new u}function T(e,t,n,r,i,o){null==o&&(o=!1),this.id=e,this.text=""!=t&&null!=t?t:e,this.type=n,this.target=i,this.condition=r,this.isExit=o,c.helperList.set(this.id,d.EVENT)}function B(e,t,n,r,i,o,a,s,u,l){null==o&&(o=!1),null==i&&(i=1),null==r&&(r=!1),this.id=e,this.text=t,this.conditions=n,this.isExit=r,this.once=o,this.count=0,this.speaker=a,this.listeners=s,this.environment=u,this.target=l,c.helperList.set(this.id,d.EVENT)}function a(e,t){this.condition=e,this.type=t}function l(){this.condition=[],a.call(this,this.condition,null)}function s(e,t,n){this._affirmation=n=null==n?!0:n,this._achievedListID=t,a.call(this,e,d.EVENT)}function r(e,t,n){this.id=e,this.type=t,this.set(n),this.startingValue=this.value,c.helperList.set(this.id,d.VARIABLE)}function E(e,t,n){this.xml=t,this.message=e,this.position=n,this.lineNumber=1;for(var r=this.positionAtLine=0,i=n;r<i;){var o=r++,o=S.fastCodeAt(t,o);10==o?(this.lineNumber++,this.positionAtLine=0):13!=o&&this.positionAtLine++}}C.__name__="StringBuf",C.prototype={add:function(e){this.b+=y.string(e)},addChar:function(e){this.b+=String.fromCodePoint(e)},addSub:function(e,t,n){this.b+=b.substr(e,t,null==n?null:n)},toString:function(){return this.b},__class__:C};var S=function(){},N=(S.__name__="StringTools",S.htmlEscape=function(e,t){for(var n=new C,r=new H(e);r.hasNext();){var i=r.next();switch(i){case 34:t?n.add("&quot;"):n.addChar(i);break;case 38:n.add("&amp;");break;case 39:t?n.add("&#039;"):n.addChar(i);break;case 60:n.add("&lt;");break;case 62:n.add("&gt;");break;default:n.addChar(i)}}return n.toString()},S.isSpace=function(e,t){e=b.cca(e,t);return 8<e&&e<14||32==e},S.ltrim=function(e){for(var t=e.length,n=0;n<t&&S.isSpace(e,n);)++n;return 0<n?b.substr(e,n,t-n):e},S.rtrim=function(e){for(var t=e.length,n=0;n<t&&S.isSpace(e,t-n-1);)++n;return 0<n?b.substr(e,0,t-n):e},S.trim=function(e){return S.ltrim(S.rtrim(e))},S.fastCodeAt=function(e,t){return e.charCodeAt(t)},S.isEof=function(e){return e!=e},S.utf16CodePointAt=function(e,t){var n=S.fastCodeAt(e,t);return n=55296<=n&&n<=56319?n-55232<<10|1023&S.fastCodeAt(e,t+1):n},w.__name__="Type",w.getClass=function(e){return q.getClass(e)},w.getClassName=function(e){return e.__name__},w.createEnum=function(e,t,n){var r=i.field(e,t);if(null==r)throw I.thrown("No such constructor "+t);if(i.isFunction(r)){if(null==n)throw I.thrown("Constructor "+t+" need parameters");return i.callMethod(e,r,n)}if(null!=n&&0!=n.length)throw I.thrown("Constructor "+t+" does not need parameters");return r},{}),e=(N.toString=function(e){switch(e){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}},x.__name__="Xml",x.parse=function(e){return V.parse(e)},x.createElement=function(e){var t=new x(x.Element);return t.set_nodeName(e),t},x.createPCData=function(e){var t=new x(x.PCData);return t.set_nodeValue(e),t},x.createCData=function(e){var t=new x(x.CData);return t.set_nodeValue(e),t},x.createComment=function(e){var t=new x(x.Comment);return t.set_nodeValue(e),t},x.createDocType=function(e){var t=new x(x.DocType);return t.set_nodeValue(e),t},x.createProcessingInstruction=function(e){var t=new x(x.ProcessingInstruction);return t.set_nodeValue(e),t},x.createDocument=function(){return new x(x.Document)},x.prototype={get_nodeName:function(){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.nodeName},set_nodeName:function(e){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.nodeName=e},get_nodeValue:function(){if(this.nodeType==x.Document||this.nodeType==x.Element)throw I.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.nodeValue},set_nodeValue:function(e){if(this.nodeType==x.Document||this.nodeType==x.Element)throw I.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.nodeValue=e},get:function(e){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.attributeMap.get(e)},set:function(e,t){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));this.attributeMap.set(e,t)},exists:function(e){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.attributeMap.exists(e)},attributes:function(){if(this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":N.toString(this.nodeType)));return this.attributeMap.keys()},iterator:function(){return this.ensureElementType(),new v(this.children)},elements:function(){this.ensureElementType();for(var e=[],t=0,n=this.children;t<n.length;){var r=n[t];++t,r.nodeType==x.Element&&e.push(r)}return new v(e)},elementsNamed:function(e){this.ensureElementType();for(var t=[],n=0,r=this.children;n<r.length;){var i=r[n];++n,i.nodeType==x.Element&&i.get_nodeName()==e&&t.push(i)}return new v(t)},firstElement:function(){this.ensureElementType();for(var e=0,t=this.children;e<t.length;){var n=t[e];if(++e,n.nodeType==x.Element)return n}return null},addChild:function(e){this.ensureElementType(),null!=e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this},removeChild:function(e){return this.ensureElementType(),!!b.remove(this.children,e)&&!(e.parent=null)},toString:function(){return P.print(this)},ensureElementType:function(){if(this.nodeType!=x.Document&&this.nodeType!=x.Element)throw I.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":N.toString(this.nodeType)))},__class__:x},T.__name__="fabula.Choice",T.prototype={__class__:T},B.__name__="fabula.Event",B.prototype={selectChoice:function(e,t,n){var r=(n=null==n?!1:n)?this.choices:this._cacheChoices;if(null!=r){if(null!=e)return r[e];if(null!=t)for(var i=0,o=r.length;i<o;){var a=i++;if(r[a].id==t)return r[a]}}return null},testConditions:function(){return null==this.conditions||this.conditions.test()},addChoice:function(e){null==this.choices&&(this.choices=[],this._cacheChoices=[]),this.choices.push(e)},__class__:B},e.fabula.Fabula=function(e,t){this._questsID=[],this._encountersID=[],this._textsID=[],this.achievedListID=[],this._achievedCallback=t,this.conditionFactory=new c(this),this._sequences=[];for(var n=0;n<e.length;){var r=e[n];++n,this.init(r)}}),D=(e.__name__="fabula.Fabula",e.prototype={init:function(e){e=D.parse(e,this.conditionFactory,this.achievedListID);this.arrayMerge(this._sequences,e.sequences)},arrayMerge:function(e,t){for(var n=0,r=t.length;n<r;){var i=n++;e.push(t[i])}},mapMerge:function(e,t){for(var n=t.keyValueIterator();n.hasNext();){var r=n.next(),i=r.key,r=r.value;e.set(i,r)}},reset:function(){this.achievedListID.splice(0,this.achievedListID.length);for(var e=0,t=this._sequences;e<t.length;){var n=t[e];if(++e,null!=n.variables)for(var r=0,i=n.variables.length;r<i;){var o=r++;n.variables[o].reset()}}},selectSequence:function(e,t){null==t&&(t=!0);for(var n=0,r=this._sequences.length;n<r;){var i=n++;if(this._sequences[i].id==e){i=this._sequences[i];if(t){if(null!=i.conditions&&!i.conditions.test())return null;this.currentSequence=i,this.currentSequence.start()}return i}}return null},getNextEvent:function(){var e=this.currentSequence.getNextEvent();return null!=e&&(this.achievedListID.push(e.id),null!=this._achievedCallback)&&this._achievedCallback(e.id),e},getCurrentEvent:function(){return this.currentSequence.events[this.currentSequence.current]},selectChoice:function(e,t){return null==e&&null!=this.currentSequence&&this.currentSequence.current<this.currentSequence.events.length&&(e=this.currentSequence.events[this.currentSequence.current].selectChoice(null,t),this.currentSequence.nextTarget=e.target),null!=e&&(this.achievedListID.push(t),null!=this._achievedCallback)&&this._achievedCallback(t),e},getVar:function(e){if(null!=this.currentSequence){e=G.get(this.currentSequence.variables,e);if(null!=e)return e}return null},updateVar:function(){},__class__:e},function(){}),U=(D.__name__="fabula.FabulaXmlParser",D.parse=function(e,t,n){D._conditionFactory=t;t=x.parse(e).firstElement();if(t.nodeType!=x.Document&&t.nodeType!=x.Element)throw I.thrown("Invalid nodeType "+(null==t.nodeType?"null":N.toString(t.nodeType)));D._xml=t;for(var r=[],i=0,o=K.resolve(D._xml,"sequence");i<o.length;){var a=o[i];if(++i,A.resolve(a,"id")){var s=k.resolve(a,"id"),u=(D.ID_GEN_HELPER=s,D.ID_GEN_COUNT=0,[]),l=null,c=new U(s),h=(c.addConditions(D._conditionFactory.create(L.getString(a,"if"))),a.elements());e:for(;h.hasNext();){var _=h.next();switch(_.nodeType==x.Document?"Document":_.get_nodeName()){case"choice":if(null==l){console.log("fabula/FabulaXmlParser.hx:75:","impossible to add a choice without a parent event");break e}l.addChoice(new T(L.getString(_,"id",D.ID_GEN_HELPER+"_C"+ ++D.ID_GEN_COUNT),D.getText(_),L.getString(_,"type"),D._conditionFactory.create(L.getString(_,"if")),L.getString(_,"target"),L.getBool(_,"exit",l.isExit)));break;case"event":if(l=new B(L.getString(_,"id",D.ID_GEN_HELPER+"_E"+ ++D.ID_GEN_COUNT),D.getText(_),D._conditionFactory.create(L.getString(_,"if")),L.getBool(_,"exit",!1),L.getInt(_,"weight",1),L.getBool(_,"once",!1),L.getString(_,"speaker"),L.getString(_,"listeners"),L.getString(_,"environment"),L.getString(_,"target")),Y.resolve(_,"choice"))for(var d=0,f=K.resolve(_,"choice");d<f.length;){var p=f[d];++d,l.addChoice(new T(L.getString(p,"id",D.ID_GEN_HELPER+"_C"+ ++D.ID_GEN_COUNT),D.getText(p),L.getString(p,"type"),D._conditionFactory.create(L.getString(p,"if")),L.getString(p,"target"),L.getBool(p,"exit",l.isExit)))}u.push(l);break;case"variable":c.addVariable(k.resolve(_,"id"),w.createEnum(j,k.resolve(_,"type").toUpperCase()),k.resolve(_,"value"))}}if(null!=l&&(l.isExit=!0,null!=l.choices))for(var g=0,m=l.choices;g<m.length;){var v=m[g];++g,v.isExit=!0}c.addSequence(u),r.push(c)}else console.log("fabula/FabulaXmlParser.hx:32:","id attribute is mandatory in the sequence tag")}for(i=0,o=K.resolve(D._xml,"list");i<o.length;){o[i];++i,console.log("fabula/FabulaXmlParser.hx:104:","coucou list")}return{sequences:r}},D.getText=function(e){var t=L.getString(e,"text");return t=""==t&&Y.resolve(e,"text")?$.get_innerData(X.resolve(e,"text")):t},function(e){this.id=e,this.current=-1,this.numCompleted=0,this.nextTarget=null}),u=(U.__name__="fabula.Sequence",U.prototype={addConditions:function(e){this.conditions=e},addVariable:function(e,t,n){switch(null==this.variables&&(this.variables=[]),t._hx_index){case 0:this.variables.push(new g(e,n));break;case 1:this.variables.push(new p(e,n));break;case 2:this.variables.push(new f(e,n))}},addSequence:function(e){null!=this.events&&console.log("fabula/Sequence.hx:54:","WARNING a new sequence will replace an old sequence"),this.events=e},start:function(){if(this.current=-1,(this.nextTarget=null)!=this.variables)for(var e=0,t=this.variables.length;e<t;){var n=e++;this.variables[n].reset()}},getNextEvent:function(e){if(!(e=null==e?!1:e)&&-1<this.current&&this.current<this.events.length&&this.events[this.current].isExit)this.numCompleted++,console.log("fabula/Sequence.hx:84:","sequence completed");else if(this.current+1<=this.events.length){if(0<=this.current){if(null!=this.nextTarget&&""!=this.nextTarget)return e=this.nextTarget,this.nextTarget=null,this.getEvent(null,e);if(null!=this.events[this.current].target&&""!=this.events[this.current].target)return this.getEvent(null,this.events[this.current].target)}if(this.current++,this.current<this.events.length)return(e=this.events[this.current]).testConditions()?e:this.getNextEvent(!0);this.numCompleted++,console.log("fabula/Sequence.hx:117:","sequence completed")}return null},getEvent:function(e,t){if(null==e&&(e=this.current),null==t)return this.events[this.current];for(var n=0,r=this.events.length;n<r;){var i=n++;if(this.events[i].id==t)return this.current=i,this.events[i]}return null},__class__:U},a.__name__="fabula.condition.Condition",a.prototype={test:function(){throw I.thrown("[Condition] Override test function")},__class__:a},l.__name__="fabula.condition.ConditionCollection",l.__super__=a,l.prototype=n(a.prototype,{add:function(e){this.condition.push(e)},test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,!n.test())return!1}return!0},__class__:l}),s.__name__="fabula.condition.ConditionEvent",s.__super__=a,s.prototype=n(a.prototype,{test:function(){for(var e=0,t=this._achievedListID;e<t.length;){var n=t[e];if(++e,n==this.condition)return this._affirmation}return!this._affirmation},__class__:s}),function(){this.h=Object.create(null)}),c=(u.__name__="haxe.ds.StringMap",u.keysIterator=function(e){var t=Object.keys(e),n=t.length,r=0;return{hasNext:function(){return r<n},next:function(){return t[(r+=1)-1]}}},u.kvIterator=function(t){var n=Object.keys(t),e=n.length,r=0;return{hasNext:function(){return r<e},next:function(){var e=n[(r+=1)-1];return{key:e,value:t[e]}}}},u.prototype={exists:function(e){return Object.prototype.hasOwnProperty.call(this.h,e)},get:function(e){return this.h[e]},set:function(e,t){this.h[e]=t},keys:function(){return u.keysIterator(this.h)},keyValueIterator:function(){return u.kvIterator(this.h)},__class__:u},function(e){this.fabula=e}),h=(c.__name__="fabula.condition.ConditionFactory",c.prototype={create:function(e){if(""==e)return null;for(var t=new l,n=-1!=e.indexOf(",")?e.split(","):e.split("&"),r=0;r<n.length;){var i=n[r];if(++r,-1!=i.indexOf("|")){for(var o=new h,a=i.split("|"),s=0;s<a.length;){var u=a[s];++s,this.addToCollection(o,u)}t.add(o)}else this.addToCollection(t,i)}return t},addToCollection:function(e,t){var n=0==t.indexOf("!"),r=(t=n?b.substr(t,1,null):t).split("="),i=t;if(1<r.length&&(t=r[0],i=r[1]),c.helperList.exists(t)){r=c.helperList.get(t);if(null==r)throw I.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type");switch(r._hx_index){case 0:e.add(new s(t,this.fabula.achievedListID,!n));break;case 1:e.add(new _(t,i,function(e,t){if(null==t)return null;null==t.__id__&&(t.__id__=O.$haxeUID++);var n;null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__];null==n&&(n=t.bind(e),e.hx__closures__[t.__id__]=n);return n}(o=this.fabula,o.getVar),!n));break;default:throw I.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type")}}else e.add(new s(t,this.fabula.achievedListID,!n))},__class__:c},function(){l.call(this)}),_=(h.__name__="fabula.condition.ConditionOr",h.__super__=l,h.prototype=n(l.prototype,{test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,n.test())return!0}return!1},__class__:h}),function(e,t,n,r){this._affirmation=r=null==r?!0:r,this._getVar=n,this._operation=M.fromString(t.charAt(0)),null!=this._operation?this._targetValue=b.substr(t,1,null):(this._affirmation?this._operation="=":this._operation="!",this._targetValue=t),a.call(this,e,d.VARIABLE)}),M=(_.__name__="fabula.condition.ConditionVariable",_.__super__=a,_.prototype=n(a.prototype,{test:function(){var e=this._getVar(this.condition),t=e.convert(this._targetValue);switch(this._operation){case"!":return e.value!=t;case"=":return e.value==t;default:return!1}},__class__:_}),{}),d=(M.fromString=function(e){switch(e){case"!":return"!";case"!in":return"!in";case"<":return"<";case"<=":return"<=";case"=":return"=";case">":return">";case">=":return">=";case"in":return"in";default:return null}},F["fabula.condition.EConditionType"]={__ename__:!0,__constructs__:["EVENT","VARIABLE","INVENTORY","HAS_CHARACTER","IS_CHARACTER","TRAIT","ATTRIBUTS","SKILLS","CUSTOM"],EVENT:{_hx_index:0,__enum__:"fabula.condition.EConditionType",toString:t},VARIABLE:{_hx_index:1,__enum__:"fabula.condition.EConditionType",toString:t},INVENTORY:{_hx_index:2,__enum__:"fabula.condition.EConditionType",toString:t},HAS_CHARACTER:{_hx_index:3,__enum__:"fabula.condition.EConditionType",toString:t},IS_CHARACTER:{_hx_index:4,__enum__:"fabula.condition.EConditionType",toString:t},TRAIT:{_hx_index:5,__enum__:"fabula.condition.EConditionType",toString:t},ATTRIBUTS:{_hx_index:6,__enum__:"fabula.condition.EConditionType",toString:t},SKILLS:{_hx_index:7,__enum__:"fabula.condition.EConditionType",toString:t},CUSTOM:((o=function(e){return{_hx_index:8,type:e,__enum__:"fabula.condition.EConditionType",toString:t}}).__params__=["type"],o)}),j=F["fabula.condition.EVariableType"]={__ename__:!0,__constructs__:["STRING","INT","FLOAT"],STRING:{_hx_index:0,__enum__:"fabula.condition.EVariableType",toString:t},INT:{_hx_index:1,__enum__:"fabula.condition.EVariableType",toString:t},FLOAT:{_hx_index:2,__enum__:"fabula.condition.EVariableType",toString:t}},G=(r.__name__="fabula.condition.Variable",r.prototype={set:function(e){throw I.thrown("[Fabula > variable] This method needs to be overriden")},convert:function(e){throw I.thrown("[Fabula > variable] This method needs to be overriden")},reset:function(){this.value=this.startingValue},__class__:r},{}),f=(G.get=function(e,t){for(var n=0;n<e.length;){var r=e[n];if(++n,r.id==t)return r}return null},function(e,t){r.call(this,e,j.FLOAT,t)}),p=(f.__name__="fabula.condition.VariableFloat",f.__super__=r,f.prototype=n(r.prototype,{set:function(e){var t=this.value;return this.value=y.parseFloat(e),t!=this.value},convert:function(e){return y.parseFloat(e)},__class__:f}),function(e,t){r.call(this,e,j.INT,t)}),g=(p.__name__="fabula.condition.VariableInt",p.__super__=r,p.prototype=n(r.prototype,{set:function(e){var t=this.value;return this.value=y.parseInt(e),t!=this.value},convert:function(e){return y.parseInt(e)},__class__:p}),function(e,t){r.call(this,e,j.STRING,t)}),I=(g.__name__="fabula.condition.VariableString",g.__super__=r,g.prototype=n(r.prototype,{set:function(e){var t=this.value;return this.value=e,t!=this.value},convert:function(e){return e},__class__:g}),function(e,t,n){Error.call(this,e),this.message=e,this.__previousException=t,this.__nativeException=null!=n?n:this}),m=(I.__name__="haxe.Exception",I.thrown=function(e){return e instanceof I?e.get_native():e instanceof Error?e:new m(e)},I.__super__=Error,I.prototype=n(Error.prototype,{__shiftStack:function(){this.__skipStack++},get_native:function(){return this.__nativeException},__class__:I}),function(e,t,n){I.call(this,String(e),t,n),this.value=e,this.__shiftStack()}),v=(m.__name__="haxe.ValueException",m.__super__=I,m.prototype=n(I.prototype,{__class__:m}),function(e){this.current=0,this.array=e}),H=(v.__name__="haxe.iterators.ArrayIterator",v.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:v},function(e){this.offset=0,this.s=e}),X=(H.__name__="haxe.iterators.StringIteratorUnicode",H.prototype={hasNext:function(){return this.offset<this.s.length},next:function(){var e=S.utf16CodePointAt(this.s,this.offset++);return 65536<=e&&this.offset++,e},__class__:H},{}),k=(X.resolve=function(e,t){var n,r=e.elementsNamed(t).next();if(null==r)throw n=e.nodeType==x.Document?"Document":e.get_nodeName(),I.thrown(n+" is missing element "+t);if(r.nodeType!=x.Document&&r.nodeType!=x.Element)throw I.thrown("Invalid nodeType "+(null==r.nodeType?"null":N.toString(r.nodeType)));return e=r},{}),A=(k.resolve=function(e,t){if(e.nodeType==x.Document)throw I.thrown("Cannot access document attribute "+t);var n=e.get(t);if(null==n)throw I.thrown(e.get_nodeName()+" is missing attribute "+t);return n},{}),Y=(A.resolve=function(e,t){if(e.nodeType==x.Document)throw I.thrown("Cannot access document attribute "+t);return e.exists(t)},{}),K=(Y.resolve=function(e,t){return e.elementsNamed(t).hasNext()},{}),$=(K.resolve=function(e,t){for(var n=[],r=e.elementsNamed(t);r.hasNext();){var i=r.next();if(i.nodeType!=x.Document&&i.nodeType!=x.Element)throw I.thrown("Invalid nodeType "+(null==i.nodeType?"null":N.toString(i.nodeType)));e=i;n.push(e)}return n},{}),V=($.get_innerData=function(e){var t=e.iterator();if(!t.hasNext())throw I.thrown((e.nodeType==x.Document?"Document":e.get_nodeName())+" does not have data");var n=t.next();if(t.hasNext()){var r=t.next();if(n.nodeType==x.PCData&&r.nodeType==x.CData&&""==S.trim(n.get_nodeValue())){if(!t.hasNext())return r.get_nodeValue();var i=t.next();if(i.nodeType==x.PCData&&""==S.trim(i.get_nodeValue())&&!t.hasNext())return r.get_nodeValue()}throw I.thrown((e.nodeType==x.Document?"Document":e.get_nodeName())+" does not only have data")}if(n.nodeType!=x.PCData&&n.nodeType!=x.CData)throw I.thrown((e.nodeType==x.Document?"Document":e.get_nodeName())+" does not have data");return n.get_nodeValue()},E.__name__="haxe.xml.XmlParserException",E.prototype={toString:function(){return w.getClassName(w.getClass(this))+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},__class__:E},function(){}),P=(V.__name__="haxe.xml.Parser",V.parse=function(e,t){null==t&&(t=!1);var n=x.createDocument();return V.doParse(e,t,0,n),n},V.doParse=function(e,t,n,r){for(var i,o,a=null,s=1,u=1,l=null,c=0,h=0,_=0,d=S.fastCodeAt(e,n=null==n?0:n),f=new C,p=1,g=-1;!S.isEof(d);){switch(s){case 0:switch(d){case 9:case 10:case 13:case 32:break;default:s=u;continue}break;case 1:if(60!=d){c=n,s=13;continue}s=0,u=2;break;case 2:switch(d){case 33:if(91==S.fastCodeAt(e,n+1)){if("CDATA["!=b.substr(e,n+=2,6).toUpperCase())throw I.thrown(new E("Expected <![CDATA[",e,n));s=17,c=(n+=5)+1}else if(68==S.fastCodeAt(e,n+1)||100==S.fastCodeAt(e,n+1)){if("OCTYPE"!=b.substr(e,n+2,6).toUpperCase())throw I.thrown(new E("Expected <!DOCTYPE",e,n));s=16,c=(n+=8)+1}else{if(45!=S.fastCodeAt(e,n+1)||45!=S.fastCodeAt(e,n+2))throw I.thrown(new E("Expected \x3c!--",e,n));s=15,c=(n+=2)+1}break;case 47:if(null==r)throw I.thrown(new E("Expected node name",e,n));c=n+1,s=0,u=10;break;case 63:s=14,c=n;break;default:s=3,c=n;continue}break;case 3:if(V.isValidChar(d))break;if(n==c)throw I.thrown(new E("Expected node name",e,n));a=x.createElement(b.substr(e,c,n-c)),r.addChild(a),++h,s=0,u=4;continue;case 4:switch(d){case 47:s=11;break;case 62:s=9;break;default:s=5,c=n;continue}break;case 5:if(V.isValidChar(d))break;if(c==n)throw I.thrown(new E("Expected attribute name",e,n));l=b.substr(e,c,n-c);if(a.exists(l))throw I.thrown(new E("Duplicate attribute ["+l+"]",e,n));s=0,u=6;continue;case 6:if(61!=d)throw I.thrown(new E("Expected =",e,n));s=0,u=7;break;case 7:switch(d){case 34:case 39:f=new C,s=8,c=n+1,g=d;break;default:throw I.thrown(new E('Expected "',e,n))}break;case 8:switch(d){case 38:f.addSub(e,c,n-c),s=18,p=8,c=n+1;break;case 60:case 62:if(t)throw I.thrown(new E("Invalid unescaped "+String.fromCodePoint(d)+" in attribute value",e,n));d==g&&(f.addSub(e,c,n-c),i=f.toString(),f=new C,a.set(l,i),s=0,u=4);break;default:d==g&&(f.addSub(e,c,n-c),i=f.toString(),f=new C,a.set(l,i),s=0,u=4)}break;case 9:c=n=V.doParse(e,t,n,a),s=1;break;case 10:if(V.isValidChar(d))break;if(c==n)throw I.thrown(new E("Expected node name",e,n));var m=b.substr(e,c,n-c);if(null==r||0!=r.nodeType)throw I.thrown(new E("Unexpected </"+m+">, tag is not open",e,n));if(m!=r.get_nodeName())throw I.thrown(new E("Expected </"+r.get_nodeName()+">",e,n));s=0,u=12;continue;case 11:if(62!=d)throw I.thrown(new E("Expected >",e,n));s=1;break;case 12:if(62==d)return 0==h&&r.addChild(x.createPCData("")),n;throw I.thrown(new E("Expected >",e,n));case 13:60==d?(f.addSub(e,c,n-c),m=x.createPCData(f.toString()),f=new C,r.addChild(m),++h,s=0,u=2):38==d&&(f.addSub(e,c,n-c),s=18,p=13,c=n+1);break;case 14:63==d&&62==S.fastCodeAt(e,n+1)&&(o=b.substr(e,c+1,++n-c-2),r.addChild(x.createProcessingInstruction(o)),++h,s=1);break;case 15:45==d&&45==S.fastCodeAt(e,n+1)&&62==S.fastCodeAt(e,n+2)&&(r.addChild(x.createComment(b.substr(e,c,n-c))),++h,n+=2,s=1);break;case 16:91==d?++_:93==d?--_:62==d&&0==_&&(r.addChild(x.createDocType(b.substr(e,c,n-c))),++h,s=1);break;case 17:93==d&&93==S.fastCodeAt(e,n+1)&&62==S.fastCodeAt(e,n+2)&&(o=x.createCData(b.substr(e,c,n-c)),r.addChild(o),++h,n+=2,s=1);break;case 18:if(59==d){var v=b.substr(e,c,n-c);if(35==S.fastCodeAt(v,0)){var w=120==S.fastCodeAt(v,1)?y.parseInt("0"+b.substr(v,1,v.length-1)):y.parseInt(b.substr(v,1,v.length-1));f.addChar(w)}else if(V.escapes.exists(v))f.add(V.escapes.get(v));else{if(t)throw I.thrown(new E("Undefined entity: "+v,e,n));f.add("&"+v+";")}c=n+1,s=p}else if(!V.isValidChar(d)&&35!=d){if(t)throw I.thrown(new E("Invalid character in entity: "+String.fromCodePoint(d),e,n));f.addChar(38),f.addSub(e,c,n-c),c=--n+1,s=p}}d=S.fastCodeAt(e,++n)}if(1==s&&(c=n,s=13),13==s){if(0==r.nodeType)throw I.thrown(new E("Unclosed node <"+r.get_nodeName()+">",e,n));n==c&&0!=h||(f.addSub(e,c,n-c),r.addChild(x.createPCData(f.toString())),++h)}else{if(t||18!=s||13!=p)throw I.thrown(new E("Unexpected end",e,n));f.addChar(38),f.addSub(e,c,n-c),r.addChild(x.createPCData(f.toString())),++h}return n},V.isValidChar=function(e){return 97<=e&&e<=122||65<=e&&e<=90||48<=e&&e<=57||58==e||46==e||95==e||45==e},function(e){this.output=new C,this.pretty=e}),q=(P.__name__="haxe.xml.Printer",P.print=function(e,t){t=new P(t=null==t?!1:t);return t.writeNode(e,""),t.output.toString()},P.prototype={writeNode:function(e,t){switch(e.nodeType){case 0:this.write(t+"<"),this.write(e.get_nodeName());for(var n=e.attributes();n.hasNext();){var r=n.next();this.write(" "+r+'="'),this.write(S.htmlEscape(e.get(r),!0)),this.write('"')}if(this.hasChildren(e)){this.write(">"),this.newline();for(var i=e.iterator();i.hasNext();){var o=i.next();this.writeNode(o,this.pretty?t+"\t":t)}this.write(t+"</"),this.write(e.get_nodeName()),this.write(">")}else this.write("/>");this.newline();break;case 1:var a=e.get_nodeValue();0!=a.length&&(this.write(t+S.htmlEscape(a)),this.newline());break;case 2:this.write(t+"<![CDATA["),this.write(e.get_nodeValue()),this.write("]]>"),this.newline();break;case 3:a=e.get_nodeValue();a="\x3c!--"+new R("[\n\r\t]+","g").replace(a,"")+"--\x3e",this.write(t),this.write(S.trim(a)),this.newline();break;case 4:this.write("<!DOCTYPE "+e.get_nodeValue()+">"),this.newline();break;case 5:this.write("<?"+e.get_nodeValue()+"?>"),this.newline();break;case 6:for(i=e.iterator();i.hasNext();){o=i.next();this.writeNode(o,t)}}},write:function(e){this.output.add(e)},newline:function(){this.pretty&&this.output.add("\n")},hasChildren:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();switch(n.nodeType){case 0:case 1:return!0;case 2:case 3:if(0!=S.ltrim(n.get_nodeValue()).length)return!0}}return!1},__class__:P},function(){}),J=(q.__name__="js.Boot",q.isClass=function(e){return e.__name__},q.isEnum=function(e){return e.__ename__},q.getClass=function(e){var t;return null==e?null:e instanceof Array?Array:null!=(t=e.__class__)?t:null!=(t=q.__nativeClassName(e))?q.__resolveNativeClass(t):null},q.__string_rec=function(i,o){if(null==i)return"null";if(5<=o.length)return"<...>";var e,a,t,n=typeof i;switch(n="function"==n&&(q.isClass(i)||q.isEnum(i))?"object":n){case"function":return"<function>";case"object":if(i.__enum__)return e=(c=F[i.__enum__]).__constructs__[i._hx_index],(a=c[e]).__params__?(o+="\t",e+"("+function(){for(var e=[],t=0,n=a.__params__;t<n.length;){var r=n[t];t+=1,e.push(q.__string_rec(i[r],o))}return e}().join(",")+")"):e;if(i instanceof Array){for(var r="[",s=(o+="\t",0),u=i.length;s<u;){var l=s++;r+=(0<l?",":"")+q.__string_rec(i[l],o)}return r+="]"}try{t=i.toString}catch(s){return"???"}if(null!=t&&t!=Object.toString&&"function"==typeof t){var c=i.toString();if("[object Object]"!=c)return c}var r="{\n",h=(o+="\t",null!=i.hasOwnProperty),_=null;for(_ in i)h&&!i.hasOwnProperty(_)||"prototype"!=_&&"__class__"!=_&&"__super__"!=_&&"__interfaces__"!=_&&"__properties__"!=_&&(2!=r.length&&(r+=", \n"),r+=o+_+" : "+q.__string_rec(i[_],o));return r+="\n"+(o=o.substring(1))+"}";case"string":return i;default:return String(i)}},q.__nativeClassName=function(e){e=q.__toStr.call(e).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},q.__resolveNativeClass=function(e){return O[e]},function(){}),L=(J.__name__="js.Lib",J.get_undefined=function(){},function(){});L.__name__="kadabra.utils.XMLUtils",L.getInt=function(e,t,n){return null==n&&(n=0),A.resolve(e,t)?y.parseInt(k.resolve(e,t)):n},L.getBool=function(e,t,n){return null==n&&(n=!0),A.resolve(e,t)?"true"==k.resolve(e,t):n},L.getString=function(e,t,n){return null==n&&(n=""),A.resolve(e,t)?k.resolve(e,t):n},O.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(b.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),(String.prototype.__class__=String).__name__="String",Array.__name__="Array",q.__toStr={}.toString,x.Element=0,x.PCData=1,x.CData=2,x.Comment=3,x.DocType=4,x.ProcessingInstruction=5,x.Document=6,c.helperList=new u,V.escapes=((e=new u).set("lt","<"),e.set("gt",">"),e.set("amp","&"),e.set("quot",'"'),e.set("apos","'"),e)}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);