// Fabula version 0.12.0 generated by Haxe
!function(L,U){"use strict";L.fabula=L.fabula||{};function t(){return R.__string_rec(this,"")}var a,F={};function e(e,t){var n,i=Object.create(e);for(n in t)i[n]=t[n];return t.toString!==Object.prototype.toString&&(i.toString=t.toString),i}function q(e,t){this.r=new RegExp(e,t.split("u").join(""))}function w(){}function r(){}function b(){}function x(){this.b=""}q.__name__="EReg",q.prototype={replace:function(e,t){return e.replace(this.r,t)},__class__:q},w.__name__="HxOverrides",w.cca=function(e,t){e=e.charCodeAt(t);return e!=e?ee.get_undefined():e},w.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},w.remove=function(e,t){t=e.indexOf(t);return-1!=t&&(e.splice(t,1),!0)},w.now=function(){return Date.now()},Math.__name__="Math",r.__name__="Reflect",r.field=function(e,t){try{return e[t]}catch(e){return null}},r.callMethod=function(e,t,n){return t.apply(e,n)},r.isFunction=function(e){return"function"==typeof e&&!(R.isClass(e)||R.isEnum(e))},b.__name__="Std",b.string=function(e){return R.__string_rec(e,"")},b.parseInt=function(e){if(null!=e)for(var t=0,n=e.length;t<n;){var i=t++,r=T.fastCodeAt(e,i);if(r<=8||14<=r&&32!=r&&45!=r)return r=T.fastCodeAt(e,1+i),i=parseInt(e,120==r||88==r?16:10),isNaN(i)?null:i}return null},b.parseFloat=function(e){return parseFloat(e)};function f(){}function E(e){this.nodeType=e,this.children=[],this.attributeMap=N.toStringMap(null)}function p(e,t,n,i,r,a,s){null==s&&(s=0),null==a&&(a=!1),this.id=e,this.text=""!=t&&null!=t?t:e,this.type=n,this.target=r,this.condition=i,this.isExit=a,this.limit=s,this.count=0,h.helperList.set(this.id,d.EVENT)}function M(e,t,n,i,r,a,s,o,u,l){null==a&&(a=0),null==r&&(r=1),null==i&&(i=!1),this.id=e,this.text=t,this.conditions=n,this.isExit=i,this.limit=a,this.count=0,this.speaker=s,this.listeners=o,this.environment=u,this.target=l,h.helperList.set(this.id,d.EVENT)}function s(e,t,n){null==n&&(n=!0),this.condition=e,this.type=t,this._affirmation=n}function l(){this.condition=[],s.call(this,this.condition,null)}function o(e,t,n){null==n&&(n=!0),this._achievedListID=t,s.call(this,e,d.EVENT,n)}function n(){this.h=Object.create(null)}function i(e,t,n){this.id=e,this.type=t,this.set(n),this.startingValue=this.value,h.helperList.set(this.id,d.VARIABLE)}function C(e,t,n){this.xml=t,this.message=e,this.position=n,this.lineNumber=1;for(var i=this.positionAtLine=0,r=n;i<r;){var a=i++,a=T.fastCodeAt(t,a);10==a?(this.lineNumber++,this.positionAtLine=0):13!=a&&this.positionAtLine++}}x.__name__="StringBuf",x.prototype={add:function(e){this.b+=b.string(e)},addChar:function(e){this.b+=String.fromCodePoint(e)},addSub:function(e,t,n){this.b+=w.substr(e,t,null==n?null:n)},toString:function(){return this.b},__class__:x};var T=function(){},u=(T.__name__="StringTools",T.htmlEscape=function(e,t){for(var n=new x,i=new K(e);i.hasNext();){var r=i.next();switch(r){case 34:t?n.add("&quot;"):n.addChar(r);break;case 38:n.add("&amp;");break;case 39:t?n.add("&#039;"):n.addChar(r);break;case 60:n.add("&lt;");break;case 62:n.add("&gt;");break;default:n.addChar(r)}}return n.toString()},T.isSpace=function(e,t){e=w.cca(e,t);return 8<e&&e<14||32==e},T.ltrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,n);)++n;return 0<n?w.substr(e,n,t-n):e},T.rtrim=function(e){for(var t=e.length,n=0;n<t&&T.isSpace(e,t-n-1);)++n;return 0<n?w.substr(e,0,t-n):e},T.trim=function(e){return T.ltrim(T.rtrim(e))},T.fastCodeAt=function(e,t){return e.charCodeAt(t)},T.unsafeCodeAt=function(e,t){return e.charCodeAt(t)},T.utf16CodePointAt=function(e,t){var n=T.fastCodeAt(e,t);return n=55296<=n&&n<=56319?n-55232<<10|1023&T.fastCodeAt(e,t+1):n},f.__name__="Type",f.getClass=function(e){return R.getClass(e)},f.getClassName=function(e){return e.__name__},f.createEnum=function(e,t,n){var i=r.field(e,t);if(null==i)throw S.thrown("No such constructor "+t);if(r.isFunction(i)){if(null==n)throw S.thrown("Constructor "+t+" need parameters");return r.callMethod(e,i,n)}if(null!=n&&0!=n.length)throw S.thrown("Constructor "+t+" does not need parameters");return i},{}),c=(u.toString=function(e){switch(e){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}},E.__name__="Xml",E.parse=function(e){return V.parse(e)},E.createElement=function(e){var t=new E(E.Element);return t.set_nodeName(e),t},E.createPCData=function(e){var t=new E(E.PCData);return t.set_nodeValue(e),t},E.createCData=function(e){var t=new E(E.CData);return t.set_nodeValue(e),t},E.createComment=function(e){var t=new E(E.Comment);return t.set_nodeValue(e),t},E.createDocType=function(e){var t=new E(E.DocType);return t.set_nodeValue(e),t},E.createProcessingInstruction=function(e){var t=new E(E.ProcessingInstruction);return t.set_nodeValue(e),t},E.createDocument=function(){return new E(E.Document)},E.prototype={get_nodeName:function(){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));return this.nodeName},set_nodeName:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));return this.nodeName=e},get_nodeValue:function(){if(this.nodeType==E.Document||this.nodeType==E.Element)throw S.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":u.toString(this.nodeType)));return this.nodeValue},set_nodeValue:function(e){if(this.nodeType==E.Document||this.nodeType==E.Element)throw S.thrown("Bad node type, unexpected "+(null==this.nodeType?"null":u.toString(this.nodeType)));return this.nodeValue=e},get:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));return N.get(this.attributeMap,e)},set:function(e,t){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));N.set(this.attributeMap,e,t)},exists:function(e){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));return N.exists(this.attributeMap,e)},attributes:function(){if(this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":u.toString(this.nodeType)));return N.keys(this.attributeMap)},iterator:function(){return this.ensureElementType(),new I(this.children)},elements:function(){this.ensureElementType();for(var e=[],t=0,n=this.children;t<n.length;){var i=n[t];++t,i.nodeType==E.Element&&e.push(i)}return new I(e)},elementsNamed:function(e){this.ensureElementType();for(var t=[],n=0,i=this.children;n<i.length;){var r=i[n];++n,r.nodeType==E.Element&&r.get_nodeName()==e&&t.push(r)}return new I(t)},firstElement:function(){this.ensureElementType();for(var e=0,t=this.children;e<t.length;){var n=t[e];if(++e,n.nodeType==E.Element)return n}return null},addChild:function(e){this.ensureElementType(),null!=e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this},removeChild:function(e){return this.ensureElementType(),!!w.remove(this.children,e)&&!(e.parent=null)},toString:function(){return O.print(this)},ensureElementType:function(){if(this.nodeType!=E.Document&&this.nodeType!=E.Element)throw S.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":u.toString(this.nodeType)))},__class__:E},p.__name__="fabula.Choice",p.prototype={__class__:p},M.__name__="fabula.Event",M.prototype={getChoices:function(){if(this._cacheChoices=[],null!=this.choices)for(var e=0,t=this.choices.length;e<t;){var n=e++;0<this.choices[n].limit&&this.choices[n].count>=this.choices[n].limit||null!=this.choices[n].condition&&!this.choices[n].condition.test()||this._cacheChoices.push(this.choices[n])}return 0==this._cacheChoices.length&&(this.isExit?this._cacheChoices.push(new p("EXIT",g.QUIT,"quit",null,this.target,!0)):this._cacheChoices.push(new p("CONTINUE",g.CONTINUE,"continue",null,this.target))),this._cacheChoices},selectChoice:function(e,t,n){var i=(n=null==n?!1:n)?this.choices:this._cacheChoices,r=null;if(null!=i)if(null!=e)for(var a=0,s=i.length;a<s;){var o=a++;if(i[o].id==e){r=i[o];break}}else null!=t&&(r=i[t]);return null!=r&&r.count++,r},testConditions:function(){var e=0<this.limit&&this.count>=this.limit;return null==this.conditions?!e:!e&&this.conditions.test()},addChoice:function(e){null==this.choices&&(this.choices=[],this._cacheChoices=[]),this.choices.push(e)},__class__:M},F["fabula.EEventType"]={__ename__:!0,__constructs__:null,QUEST:{_hx_name:"QUEST",_hx_index:0,__enum__:"fabula.EEventType",toString:t},RANDOM_ENCOUNTER:{_hx_name:"RANDOM_ENCOUNTER",_hx_index:1,__enum__:"fabula.EEventType",toString:t},SCENE:{_hx_name:"SCENE",_hx_index:2,__enum__:"fabula.EEventType",toString:t}}),c=(c.__constructs__=[c.QUEST,c.RANDOM_ENCOUNTER,c.SCENE],F["fabula.EPlayingType"]={__ename__:!0,__constructs__:null,SEQUENCE:{_hx_name:"SEQUENCE",_hx_index:0,__enum__:"fabula.EPlayingType",toString:t},DRAW:{_hx_name:"DRAW",_hx_index:1,__enum__:"fabula.EPlayingType",toString:t}}),g=(c.__constructs__=[c.SEQUENCE,c.DRAW],L.fabula.Fabula=function(e,t){this._questsID=[],this._encountersID=[],this._textsID=[],this.achievedListID=[],this._achievedCallback=t,this.conditionFactory=new h(this),this._sequences=[];for(var n=0;n<e.length;){var i=e[n];++n,this.init(i)}}),m=(g.__name__="fabula.Fabula",g.prototype={init:function(e){e=m.parse(e,this.conditionFactory,this.achievedListID);this.arrayMerge(this._sequences,e.sequences)},arrayMerge:function(e,t){for(var n=0,i=t.length;n<i;){var r=n++;e.push(t[r])}},mapMerge:function(e,t){for(var n,i=((n=N)instanceof Array?function(){return w.keyValueIter(n)}:"function"==typeof n.keyValueIterator?te(n,n.keyValueIterator):n.keyValueIterator)(t);i.hasNext();){var r=i.next(),a=r.key,r=r.value;N.arrayWrite(e,a,r)}},reset:function(){this.achievedListID.splice(0,this.achievedListID.length);for(var e=0,t=this._sequences;e<t.length;){var n=t[e];if(++e,null!=n.variables)for(var i=0,r=n.variables.length;i<r;){var a=i++;y.getUserByIndex(n.variables,a).reset()}for(var s=0,o=n.events;s<o.length;){var u=o[s];if(++s,u.count=0,null!=u.choices)for(var l=0,c=u.choices;l<c.length;){var h=c[l];++l,h.count=0}}}},selectSequence:function(e,t){null==t&&(t=!0);for(var n=0,i=this._sequences.length;n<i;){var r=n++;if(this._sequences[r].id==e){r=this._sequences[r];if(t){if(null!=r.conditions&&!r.conditions.test())return null;this.currentSequence=r,this.currentSequence.start()}return r}}return null},getNextEvent:function(){var e=this.currentSequence.getNextEvent();return null!=e&&(e.count++,this.achievedListID.push(e.id),null!=this._achievedCallback)&&this._achievedCallback(e.id),e},getCurrentEvent:function(){return this.currentSequence.getEvent()},selectChoice:function(e,t){var n=null;return null!=this.currentSequence&&this.currentSequence.current<this.currentSequence.events.length&&(n=this.currentSequence.getEvent().selectChoice(e,t),this.currentSequence.nextTarget=n.isExit?"$$EXIT$$":n.target),null!=n&&(this.achievedListID.push(e),null!=this._achievedCallback)&&this._achievedCallback(e),n},getVar:function(e){if(null!=this.currentSequence){e=y.get(this.currentSequence.variables,e);if(null!=e)return e}return null},updateVar:function(){},countWords:function(){for(var e=0,t=0,n=this._sequences;t<n.length;){var i=n[t];if(++t,null!=i.events)for(var r=0,a=i.events;r<a.length;){var s=a[r];if(++r,e+=s.text.split(" ").length,null!=s.choices)for(var o=0,u=s.choices;o<u.length;){var l=u[o];++o,e+=l.text.split(" ").length}}}return e},__class__:g},function(){}),B=(m.__name__="fabula.FabulaXmlParser",m.parse=function(e,t,n){m._conditionFactory=t,m._xml=D._new(E.parse(e).firstElement());for(var i=[],r=0,a=Z.resolve(D.get_nodes(m._xml),"sequence");r<a.length;){var s=a[r];if(++r,k.resolve(D.get_has(s),"id")){var o=A.resolve(D.get_att(s),"id"),u=(m.ID_GEN_HELPER=o,m.ID_GEN_COUNT=0,[]),l=[],o=new B(o),s=(o.addConditions(m._conditionFactory.create(P.getString(s,"if"))),m.parseEvents(s,o,u,l));if(null!=s)if(console.log("fabula/FabulaXmlParser.hx:49:",s.id),null!=s.choices)for(var c=0,h=s.choices;c<h.length;){var _=h[c];++c,null==_.target&&(_.isExit=!0)}else s.isExit=!0;o.addSequence(u,l),i.push(o)}else console.log("fabula/FabulaXmlParser.hx:32:","id attribute is mandatory in the sequence tag")}if(z.resolve(D.get_hasNode(m._xml),"words"))for(var d=D.get_elements(Z.resolve(D.get_nodes(m._xml),"words")[0]);d.hasNext();){var f=d.next();switch(D.get_name(f).toUpperCase()){case"CONTINUE":g.CONTINUE=D.get_innerData(f);break;case"QUIT":g.QUIT=D.get_innerData(f)}}for(r=0,a=Z.resolve(D.get_nodes(m._xml),"list");r<a.length;){a[r];++r,console.log("fabula/FabulaXmlParser.hx:86:","coucou list")}return{sequences:i}},m.parseEvents=function(e,t,n,i,r){var a=null,s=D.get_elements(e);e:for(;s.hasNext();){var o=s.next();switch(D.get_name(o)){case"choice":if(null==a){console.log("fabula/FabulaXmlParser.hx:148:","impossible to add a choice without a parent event");break e}a.addChoice(new p(P.getString(o,"id",m.ID_GEN_HELPER+"_C"+ ++m.ID_GEN_COUNT),m.getText(o),P.getString(o,"type"),m._conditionFactory.create(P.getString(o,"if")),P.getString(o,"target"),P.getBool(o,"exit",a.isExit),P.getInt(o,"limit")));break;case"event":var u,l=P.getString(o,"id",m.ID_GEN_HELPER+"_E"+ ++m.ID_GEN_COUNT);if(null==r?u=P.getString(o,"if"):(u=r.id,r.target=l),a=new M(l,m.getText(o),m._conditionFactory.create(u),P.getBool(o,"exit",!1),P.getInt(o,"weight",1),P.getInt(o,"limit"),P.getString(o,"speaker"),P.getString(o,"listeners"),P.getString(o,"environment"),P.getString(o,"target")),z.resolve(D.get_hasNode(o),"choice"))for(var c=0,h=Z.resolve(D.get_nodes(o),"choice");c<h.length;){var _=h[c],d=(++c,new p(P.getString(_,"id",m.ID_GEN_HELPER+"_C"+ ++m.ID_GEN_COUNT),m.getText(_),P.getString(_,"type"),m._conditionFactory.create(P.getString(_,"if")),P.getString(_,"target"),P.getBool(_,"exit",a.isExit),P.getInt(_,"limit")));a.addChoice(d),z.resolve(D.get_hasNode(_),"event")&&m.parseEvents(_,t,n,i,d)}(null==r?n:i).push(a);break;case"variable":t.addVariable(A.resolve(D.get_att(o),"id"),f.createEnum(v,A.resolve(D.get_att(o),"type").toUpperCase()),A.resolve(D.get_att(o),"value"))}}return a},m.getText=function(e){var t=P.getString(e,"text");return t=""==t&&z.resolve(D.get_hasNode(e),"text")?D.get_innerData(J.resolve(D.get_node(e),"text")):t},function(e){this.id=e,this.current=-1,this.currentId=null,this.numCompleted=0,this.nextTarget=null}),h=(B.__name__="fabula.Sequence",B.prototype={addConditions:function(e){this.conditions=e},addVariable:function(e,t,n){switch(null==this.variables&&(this.variables=y._new()),t._hx_index){case 0:this.variables.push(new $(e,n));break;case 1:this.variables.push(new Q(e,n));break;case 2:this.variables.push(new H(e,n))}},addSequence:function(e,t){null==this.events&&null==this.branches||console.log("fabula/Sequence.hx:62:","WARNING a new sequence will replace an old sequence"),this.events=e,this.branches=t},start:function(){if(this.current=-1,this.nextTarget=null,(this.currentId=null)!=this.variables)for(var e=0,t=this.variables.length;e<t;){var n=e++;y.getUserByIndex(this.variables,n).reset()}},getNextEvent:function(e){if(!(e=null==e?!1:e)&&-1<this.current&&this.current<this.events.length&&(this.events[this.current].isExit||"$$EXIT$$"==this.nextTarget))this.numCompleted++,console.log("fabula/Sequence.hx:94:","[Fabula] sequence "+this.id+" completed");else if(this.current+1<=this.events.length){if(0<=this.current){if(null!=this.nextTarget&&""!=this.nextTarget)return e=this.nextTarget,this.nextTarget=null,this.getEvent(e);if(null!=this.events[this.current].target&&""!=this.events[this.current].target)return this.getEvent(this.events[this.current].target)}if(this.current++,this.current<this.events.length)return(e=this.events[this.current]).testConditions()?(this.currentId=e.id,e):this.getNextEvent(!0);this.numCompleted++,console.log("fabula/Sequence.hx:128:","sequence completed")}return null},getEvent:function(e){null==e&&(e=this.currentId);for(var t=0,n=this.events.length;t<n;){var i=t++;if(this.events[i].id==e)return this.current=i,this.currentId=e,this.events[i]}for(t=0,n=this.branches.length;t<n;){i=t++;if(this.branches[i].id==e)return this.currentId=e,this.branches[i]}return null},__class__:B},s.__name__="fabula.condition.Condition",s.prototype={test:function(){throw S.thrown("[Condition] Override test function")},__class__:s},l.__name__="fabula.condition.ConditionCollection",l.__super__=s,l.prototype=e(s.prototype,{add:function(e){this.condition.push(e)},test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,!n.test())return!1}return!0},hasType:function(e){for(var t=0,n=this.condition;t<n.length;){var i=n[t];if(++t,i.type==e)return!0}return!1},hasOnlyTypes:function(e){for(var t=0,n=this.condition;t<n.length;){var i=n[t];if(++t,null==i.type){if(!i.hasOnlyTypes(e))return!1}else if(-1==e.indexOf(i.type))return!1}return!0},__class__:l}),o.__name__="fabula.condition.ConditionEvent",o.__super__=s,o.prototype=e(s.prototype,{test:function(){for(var e=0,t=this._achievedListID;e<t.length;){var n=t[e];if(++e,n==this.condition)return this._affirmation}return!this._affirmation},__class__:o}),n.__name__="haxe.ds.StringMap",n.prototype={exists:function(e){return Object.prototype.hasOwnProperty.call(this.h,e)},get:function(e){return this.h[e]},set:function(e,t){this.h[e]=t},keys:function(){return new W(this.h)},keyValueIterator:function(){return new Y(this.h)},__class__:n},function(e){this.fabula=e}),j=(h.__name__="fabula.condition.ConditionFactory",h.prototype={create:function(e){if(""==e)return null;for(var t=new l,n=-1!=e.indexOf(",")?e.split(","):e.split("&"),i=0;i<n.length;){var r=n[i];if(++i,-1!=r.indexOf("|")){for(var a=new j,s=r.split("|"),o=0;o<s.length;){var u=s[o];++o,this.addToCollection(a,u)}t.add(a)}else this.addToCollection(t,r)}return t},addToCollection:function(e,t){var n=0==t.indexOf("!"),i=(t=n?w.substr(t,1,null):t).split("="),r=t;if(1<i.length&&(t=i[0],r=i[1]),h.helperList.exists(t)){i=h.helperList.get(t);if(null==i)throw S.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type");switch(i._hx_index){case 0:e.add(new o(t,this.fabula.achievedListID,!n));break;case 1:e.add(new G(t,r,te(a=this.fabula,a.getVar),!n));break;default:throw S.thrown("[Fabula > Condition] To use other condition type, please override ConditionFactory class and create a Condition class for this type")}}else e.add(new o(t,this.fabula.achievedListID,!n))},__class__:h},function(){l.call(this)}),G=(j.__name__="fabula.condition.ConditionOr",j.__super__=l,j.prototype=e(l.prototype,{test:function(){for(var e=0,t=this.condition;e<t.length;){var n=t[e];if(++e,n.test())return!0}return!1},__class__:j}),function(e,t,n,i){null==i&&(i=!0),this._getVar=n,this._operation=_.fromString(t.charAt(0)),null!=this._operation?this._targetValue=w.substr(t,1,null):(this._affirmation?this._operation="=":this._operation="!",this._targetValue=t),s.call(this,e,d.VARIABLE,i)}),_=(G.__name__="fabula.condition.ConditionVariable",G.__super__=s,G.prototype=e(s.prototype,{test:function(){var e=this._getVar(this.condition),t=e.convert(this._targetValue);switch(this._operation){case"!":return e.value!=t;case"=":return e.value==t;default:return!1}},__class__:G}),{}),d=(_.fromString=function(e){switch(e){case"!":return"!";case"!in":return"!in";case"<":return"<";case"<=":return"<=";case"=":return"=";case">":return">";case">=":return">=";case"in":return"in";default:return null}},F["fabula.condition.EConditionType"]={__ename__:!0,__constructs__:null,EVENT:{_hx_name:"EVENT",_hx_index:0,__enum__:"fabula.condition.EConditionType",toString:t},VARIABLE:{_hx_name:"VARIABLE",_hx_index:1,__enum__:"fabula.condition.EConditionType",toString:t},INVENTORY:{_hx_name:"INVENTORY",_hx_index:2,__enum__:"fabula.condition.EConditionType",toString:t},HAS_CHARACTER:{_hx_name:"HAS_CHARACTER",_hx_index:3,__enum__:"fabula.condition.EConditionType",toString:t},IS_CHARACTER:{_hx_name:"IS_CHARACTER",_hx_index:4,__enum__:"fabula.condition.EConditionType",toString:t},TRAIT:{_hx_name:"TRAIT",_hx_index:5,__enum__:"fabula.condition.EConditionType",toString:t},ATTRIBUTS:{_hx_name:"ATTRIBUTS",_hx_index:6,__enum__:"fabula.condition.EConditionType",toString:t},SKILLS:{_hx_name:"SKILLS",_hx_index:7,__enum__:"fabula.condition.EConditionType",toString:t},CUSTOM:((a=function(e){return{_hx_index:8,type:e,__enum__:"fabula.condition.EConditionType",toString:t}})._hx_name="CUSTOM",a.__params__=["type"],a)}),v=(d.__constructs__=[d.EVENT,d.VARIABLE,d.INVENTORY,d.HAS_CHARACTER,d.IS_CHARACTER,d.TRAIT,d.ATTRIBUTS,d.SKILLS,d.CUSTOM],F["fabula.condition.EVariableType"]={__ename__:!0,__constructs__:null,STRING:{_hx_name:"STRING",_hx_index:0,__enum__:"fabula.condition.EVariableType",toString:t},INT:{_hx_name:"INT",_hx_index:1,__enum__:"fabula.condition.EVariableType",toString:t},FLOAT:{_hx_name:"FLOAT",_hx_index:2,__enum__:"fabula.condition.EVariableType",toString:t}}),y=(v.__constructs__=[v.STRING,v.INT,v.FLOAT],i.__name__="fabula.condition.Variable",i.prototype={set:function(e){throw S.thrown("[Fabula > variable] This method needs to be overriden")},convert:function(e){throw S.thrown("[Fabula > variable] This method needs to be overriden")},reset:function(){this.value=this.startingValue},toString:function(){return"[var "+this.id+" : v:"+b.string(this.value)+", d:"+b.string(this.startingValue)+"]"},__class__:i},{}),H=(y._new=function(){return[]},y.getUserByIndex=function(e,t){return e[t]},y.get=function(e,t){for(var n=0;n<e.length;){var i=e[n];if(++n,i.id==t)return i}return null},function(e,t){i.call(this,e,v.FLOAT,t)}),Q=(H.__name__="fabula.condition.VariableFloat",H.__super__=i,H.prototype=e(i.prototype,{set:function(e){var t=this.value;return this.value=b.parseFloat(e),t!=this.value},convert:function(e){return b.parseFloat(e)},__class__:H}),function(e,t){i.call(this,e,v.INT,t)}),$=(Q.__name__="fabula.condition.VariableInt",Q.__super__=i,Q.prototype=e(i.prototype,{set:function(e){var t=this.value;return this.value=b.parseInt(e),t!=this.value},convert:function(e){return b.parseInt(e)},__class__:Q}),function(e,t){i.call(this,e,v.STRING,t)}),S=($.__name__="fabula.condition.VariableString",$.__super__=i,$.prototype=e(i.prototype,{set:function(e){var t=this.value;return this.value=e,t!=this.value},convert:function(e){return e},__class__:$}),function(e,t,n){Error.call(this,e),this.message=e,this.__previousException=t,this.__nativeException=null!=n?n:this}),X=(S.__name__="haxe.Exception",S.thrown=function(e){return e instanceof S?e.get_native():e instanceof Error?e:new X(e)},S.__super__=Error,S.prototype=e(Error.prototype,{__shiftStack:function(){this.__skipStack++},get_native:function(){return this.__nativeException},__class__:S}),function(e,t,n){S.call(this,String(e),t,n),this.value=e,this.__shiftStack()}),N=(X.__name__="haxe.ValueException",X.__super__=S,X.prototype=e(S.prototype,{__class__:X}),{}),W=(N.set=function(e,t,n){e.set(t,n)},N.get=function(e,t){return e.get(t)},N.exists=function(e,t){return e.exists(t)},N.keys=function(e){return e.keys()},N.keyValueIterator=function(e){return e.keyValueIterator()},N.arrayWrite=function(e,t,n){return e.set(t,n),n},N.toStringMap=function(e){return new n},function(e){this.h=e,this.keys=Object.keys(e),this.length=this.keys.length,this.current=0}),Y=(W.__name__="haxe.ds._StringMap.StringMapKeyIterator",W.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.keys[this.current++]},__class__:W},function(e){this.h=e,this.keys=Object.keys(e),this.length=this.keys.length,this.current=0}),I=(Y.__name__="haxe.ds._StringMap.StringMapKeyValueIterator",Y.prototype={hasNext:function(){return this.current<this.length},next:function(){var e=this.keys[this.current++];return{key:e,value:this.h[e]}},__class__:Y},function(e){this.current=0,this.array=e}),K=(I.__name__="haxe.iterators.ArrayIterator",I.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:I},function(e){this.offset=0,this.s=e}),J=(K.__name__="haxe.iterators.StringIteratorUnicode",K.prototype={hasNext:function(){return this.offset<this.s.length},next:function(){var e=T.utf16CodePointAt(this.s,this.offset++);return 65536<=e&&this.offset++,e},__class__:K},{}),A=(J.resolve=function(e,t){var n=e.elementsNamed(t).next();if(null==n)throw e=e.nodeType==E.Document?"Document":e.get_nodeName(),S.thrown(e+" is missing element "+t);return D._new(n)},{}),k=(A.resolve=function(e,t){if(e.nodeType==E.Document)throw S.thrown("Cannot access document attribute "+t);var n=e.get(t);if(null==n)throw S.thrown(e.get_nodeName()+" is missing attribute "+t);return n},{}),z=(k.resolve=function(e,t){if(e.nodeType==E.Document)throw S.thrown("Cannot access document attribute "+t);return e.exists(t)},{}),Z=(z.resolve=function(e,t){return e.elementsNamed(t).hasNext()},{}),D=(Z.resolve=function(e,t){for(var n=[],i=e.elementsNamed(t);i.hasNext();){var r=i.next();n.push(D._new(r))}return n},{}),V=(D.get_x=function(e){return e},D.get_name=function(e){return e.nodeType==E.Document?"Document":e.get_nodeName()},D.get_node=function(e){return D.get_x(e)},D.get_nodes=function(e){return e},D.get_att=function(e){return e},D.get_has=function(e){return e},D.get_hasNode=function(e){return D.get_x(e)},D.get_elements=function(e){return e.elements()},D._new=function(e){if(e.nodeType!=E.Document&&e.nodeType!=E.Element)throw S.thrown("Invalid nodeType "+(null==e.nodeType?"null":u.toString(e.nodeType)));return e},D.get_innerData=function(e){var t=e.iterator();if(!t.hasNext())throw S.thrown(D.get_name(e)+" does not have data");var n=t.next();if(t.hasNext()){var i=t.next();if(n.nodeType==E.PCData&&i.nodeType==E.CData&&""==T.trim(n.get_nodeValue())){if(!t.hasNext())return i.get_nodeValue();var r=t.next();if(r.nodeType==E.PCData&&""==T.trim(r.get_nodeValue())&&!t.hasNext())return i.get_nodeValue()}throw S.thrown(D.get_name(e)+" does not only have data")}if(n.nodeType!=E.PCData&&n.nodeType!=E.CData)throw S.thrown(D.get_name(e)+" does not have data");return n.get_nodeValue()},C.__name__="haxe.xml.XmlParserException",C.prototype={toString:function(){return f.getClassName(f.getClass(this))+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},__class__:C},function(){}),O=(V.__name__="haxe.xml.Parser",V.parse=function(e,t){null==t&&(t=!1);var n=E.createDocument();return V.doParse(e,t,0,n),n},V.doParse=function(e,t,n,i){null==n&&(n=0);for(var r=null,a=1,s=1,o=null,u=0,l=0,c=0,h=new x,_=1,d=-1;n<e.length;){var f,p,g=T.unsafeCodeAt(e,n);switch(a){case 0:switch(g){case 9:case 10:case 13:case 32:break;default:a=s;continue}break;case 1:if(60!=g){u=n,a=13;continue}a=0,s=2;break;case 2:switch(g){case 33:if(91==T.fastCodeAt(e,n+1)){if("CDATA["!=w.substr(e,n+=2,6).toUpperCase())throw S.thrown(new C("Expected <![CDATA[",e,n));a=17,u=(n+=5)+1}else if(68==T.fastCodeAt(e,n+1)||100==T.fastCodeAt(e,n+1)){if("OCTYPE"!=w.substr(e,n+2,6).toUpperCase())throw S.thrown(new C("Expected <!DOCTYPE",e,n));a=16,u=(n+=8)+1}else{if(45!=T.fastCodeAt(e,n+1)||45!=T.fastCodeAt(e,n+2))throw S.thrown(new C("Expected \x3c!--",e,n));a=15,u=(n+=2)+1}break;case 47:if(null==i)throw S.thrown(new C("Expected node name",e,n));u=n+1,a=0,s=10;break;case 63:a=14,u=n;break;default:a=3,u=n;continue}break;case 3:if(V.isValidChar(g))break;if(n==u)throw S.thrown(new C("Expected node name",e,n));r=E.createElement(w.substr(e,u,n-u)),i.addChild(r),++l,a=0,s=4;continue;case 4:switch(g){case 47:a=11;break;case 62:a=9;break;default:a=5,u=n;continue}break;case 5:if(V.isValidChar(g))break;if(u==n)throw S.thrown(new C("Expected attribute name",e,n));o=w.substr(e,u,n-u);if(r.exists(o))throw S.thrown(new C("Duplicate attribute ["+o+"]",e,n));a=0,s=6;continue;case 6:if(61!=g)throw S.thrown(new C("Expected =",e,n));a=0,s=7;break;case 7:switch(g){case 34:case 39:h=new x,a=8,u=n+1,d=g;break;default:throw S.thrown(new C('Expected "',e,n))}break;case 8:switch(g){case 38:h.addSub(e,u,n-u),a=18,_=8,u=n+1;break;case 60:case 62:if(t)throw S.thrown(new C("Invalid unescaped "+String.fromCodePoint(g)+" in attribute value",e,n));g==d&&(h.addSub(e,u,n-u),f=h.toString(),h=new x,r.set(o,f),a=0,s=4);break;default:g==d&&(h.addSub(e,u,n-u),f=h.toString(),h=new x,r.set(o,f),a=0,s=4)}break;case 9:u=n=V.doParse(e,t,n,r),a=1;break;case 10:if(V.isValidChar(g))break;if(u==n)throw S.thrown(new C("Expected node name",e,n));var m=w.substr(e,u,n-u);if(null==i||0!=i.nodeType)throw S.thrown(new C("Unexpected </"+m+">, tag is not open",e,n));if(m!=i.get_nodeName())throw S.thrown(new C("Expected </"+i.get_nodeName()+">",e,n));a=0,s=12;continue;case 11:if(62!=g)throw S.thrown(new C("Expected >",e,n));a=1;break;case 12:if(62==g)return 0==l&&i.addChild(E.createPCData("")),n;throw S.thrown(new C("Expected >",e,n));case 13:60==g?(h.addSub(e,u,n-u),m=E.createPCData(h.toString()),h=new x,i.addChild(m),++l,a=0,s=2):38==g&&(h.addSub(e,u,n-u),a=18,_=13,u=n+1);break;case 14:63==g&&62==T.fastCodeAt(e,n+1)&&(p=w.substr(e,u+1,++n-u-2),i.addChild(E.createProcessingInstruction(p)),++l,a=1);break;case 15:45==g&&45==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(i.addChild(E.createComment(w.substr(e,u,n-u))),++l,n+=2,a=1);break;case 16:91==g?++c:93==g?--c:62==g&&0==c&&(i.addChild(E.createDocType(w.substr(e,u,n-u))),++l,a=1);break;case 17:93==g&&93==T.fastCodeAt(e,n+1)&&62==T.fastCodeAt(e,n+2)&&(p=E.createCData(w.substr(e,u,n-u)),i.addChild(p),++l,n+=2,a=1);break;case 18:if(59==g){var v=w.substr(e,u,n-u);if(35==T.fastCodeAt(v,0)){var y=120==T.fastCodeAt(v,1)?b.parseInt("0"+w.substr(v,1,v.length-1)):b.parseInt(w.substr(v,1,v.length-1));h.addChar(y)}else if(V.escapes.exists(v))h.add(V.escapes.get(v));else{if(t)throw S.thrown(new C("Undefined entity: "+v,e,n));h.add("&"+v+";")}u=n+1,a=_}else if(!V.isValidChar(g)&&35!=g){if(t)throw S.thrown(new C("Invalid character in entity: "+String.fromCodePoint(g),e,n));h.addChar(38),h.addSub(e,u,n-u),u=--n+1,a=_}}++n}if(1==a&&(u=n,a=13),13==a){if(0==i.nodeType)throw S.thrown(new C("Unclosed node <"+i.get_nodeName()+">",e,n));n==u&&0!=l||(h.addSub(e,u,n-u),i.addChild(E.createPCData(h.toString())),++l)}else{if(t||18!=a||13!=_)throw S.thrown(new C("Unexpected end",e,n));h.addChar(38),h.addSub(e,u,n-u),i.addChild(E.createPCData(h.toString())),++l}return n},V.isValidChar=function(e){return 97<=e&&e<=122||65<=e&&e<=90||48<=e&&e<=57||58==e||46==e||95==e||45==e},function(e){this.output=new x,this.pretty=e}),R=(O.__name__="haxe.xml.Printer",O.print=function(e,t){t=new O(t=null==t?!1:t);return t.writeNode(e,""),t.output.toString()},O.prototype={writeNode:function(e,t){switch(e.nodeType){case 0:this.write(t+"<"),this.write(e.get_nodeName());for(var n=e.attributes();n.hasNext();){var i=n.next();this.write(" "+i+'="'),this.write(T.htmlEscape(e.get(i),!0)),this.write('"')}if(this.hasChildren(e)){this.write(">"),this.newline();for(var r=e.iterator();r.hasNext();){var a=r.next();this.writeNode(a,this.pretty?t+"\t":t)}this.write(t+"</"),this.write(e.get_nodeName()),this.write(">")}else this.write("/>");this.newline();break;case 1:var s=e.get_nodeValue();0!=s.length&&(this.write(t+T.htmlEscape(s)),this.newline());break;case 2:this.write(t+"<![CDATA["),this.write(e.get_nodeValue()),this.write("]]>"),this.newline();break;case 3:s=e.get_nodeValue();s="\x3c!--"+new q("[\n\r\t]+","g").replace(s,"")+"--\x3e",this.write(t),this.write(T.trim(s)),this.newline();break;case 4:this.write("<!DOCTYPE "+e.get_nodeValue()+">"),this.newline();break;case 5:this.write("<?"+e.get_nodeValue()+"?>"),this.newline();break;case 6:for(r=e.iterator();r.hasNext();){a=r.next();this.writeNode(a,t)}}},write:function(e){this.output.add(e)},newline:function(){this.pretty&&this.output.add("\n")},hasChildren:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();switch(n.nodeType){case 0:case 1:return!0;case 2:case 3:if(0!=T.ltrim(n.get_nodeValue()).length)return!0}}return!1},__class__:O},function(){}),ee=(R.__name__="js.Boot",R.isClass=function(e){return e.__name__},R.isEnum=function(e){return e.__ename__},R.getClass=function(e){var t;return null==e?null:e instanceof Array?Array:null!=(t=e.__class__)?t:null!=(t=R.__nativeClassName(e))?R.__resolveNativeClass(t):null},R.__string_rec=function(r,a){if(null==r)return"null";if(5<=a.length)return"<...>";var s,e,t=typeof r;switch(t="function"==t&&(R.isClass(r)||R.isEnum(r))?"object":t){case"function":return"<function>";case"object":if(r.__enum__)return l=(s=F[r.__enum__].__constructs__[r._hx_index])._hx_name,s.__params__?(a+="\t",l+"("+function(){for(var e=[],t=0,n=s.__params__;t<n.length;){var i=n[t];t+=1,e.push(R.__string_rec(r[i],a))}return e}().join(",")+")"):l;if(r instanceof Array){for(var n="[",i=(a+="\t",0),o=r.length;i<o;){var u=i++;n+=(0<u?",":"")+R.__string_rec(r[u],a)}return n+="]"}try{e=r.toString}catch(i){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e){var l=r.toString();if("[object Object]"!=l)return l}var n="{\n",c=(a+="\t",null!=r.hasOwnProperty),h=null;for(h in r)c&&!r.hasOwnProperty(h)||"prototype"!=h&&"__class__"!=h&&"__super__"!=h&&"__interfaces__"!=h&&"__properties__"!=h&&(2!=n.length&&(n+=", \n"),n+=a+h+" : "+R.__string_rec(r[h],a));return n+="\n"+(a=a.substring(1))+"}";case"string":return r;default:return String(r)}},R.__nativeClassName=function(e){e=R.__toStr.call(e).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},R.__resolveNativeClass=function(e){return U[e]},function(){}),P=(ee.__name__="js.Lib",ee.get_undefined=function(){},function(){});function te(e,t){var n;return null==t?null:(null==t.__id__&&(t.__id__=U.$haxeUID++),null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__],null==n&&(n=t.bind(e),e.hx__closures__[t.__id__]=n),n)}P.__name__="kadabra.utils.XMLUtils",P.getFloat=function(e,t,n){return null==n&&(n=0),k.resolve(D.get_has(e),t)?b.parseFloat(A.resolve(D.get_att(e),t)):n},P.getInt=function(e,t,n){return null==n&&(n=0),k.resolve(D.get_has(e),t)?b.parseInt(A.resolve(D.get_att(e),t)):n},P.getBool=function(e,t,n){return null==n&&(n=!0),k.resolve(D.get_has(e),t)?"true"==A.resolve(D.get_att(e),t):n},P.getString=function(e,t,n){return null==n&&(n=""),k.resolve(D.get_has(e),t)?A.resolve(D.get_att(e),t):n},P.getFirstChild=function(e){for(var t=null,n=D.get_elements(e);n.hasNext();){t=n.next();break}return t},U.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(w.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),(String.prototype.__class__=String).__name__="String",Array.__name__="Array",R.__toStr={}.toString,E.Element=0,E.PCData=1,E.CData=2,E.Comment=3,E.DocType=4,E.ProcessingInstruction=5,E.Document=6,g.CONTINUE="Continue",g.QUIT="Quit",B.EXIT="$$EXIT$$",h.helperList=new n,_.GREATER=">",_.LOWER="<",_.GREATER_EQUAL=">=",_.LOWER_EQUAL="<=",_.EQUAL="=",_.DIFFERENT="!",_.NOT_IN="!in",_.IN="in",V.escapes=((c=new n).set("lt","<"),c.set("gt",">"),c.set("amp","&"),c.set("quot",'"'),c.set("apos","'"),c)}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);